<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #ffffff;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 20px;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
            padding: 0 10px;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #e0e0e0;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #4a7c2a 0%, #2d5016 100%);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: #2d5016;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .step.active .step-label {
            color: #4a7c2a;
            font-weight: 700;
        }

        .step-content {
            display: none;
            min-height: 450px;
            padding-bottom: 20px;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #2d5016;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            padding: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .category-card:hover {
            border-color: #4a7c2a;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(74, 124, 42, 0.2);
            background: white;
        }

        .category-card.selected {
            border-color: #4a7c2a;
            background: #f0f8f0;
            box-shadow: 0 5px 15px rgba(74, 124, 42, 0.3);
        }

        .category-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .type-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .type-item {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            background: #fafafa;
        }

        .type-item:hover {
            border-color: #4a7c2a;
            background: white;
            transform: translateX(-5px);
        }

        .type-item.selected {
            border-color: #4a7c2a;
            background: #f0f8f0;
            box-shadow: 0 3px 10px rgba(74, 124, 42, 0.2);
        }

        .type-icon {
            font-size: 40px;
            min-width: 50px;
        }

        .type-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            color: #2d5016;
        }

        .type-info p {
            font-size: 14px;
            color: #666;
        }

        .coming-soon {
            opacity: 0.6;
            position: relative;
            pointer-events: none;
        }

        .coming-soon::after {
            content: 'Ù‚Ø±ÙŠØ¨Ø§Ù‹';
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a7c2a;
            box-shadow: 0 0 0 3px rgba(74, 124, 42, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .multi-select {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            background: #fafafa;
        }

        .multi-select-item {
            padding: 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            border: 1px solid #e0e0e0;
        }

        .multi-select-item:hover {
            background: #f5f5f5;
            border-color: #4a7c2a;
        }

        .multi-select-item.selected {
            background: #f0f8f0;
            border: 2px solid #4a7c2a;
            font-weight: 600;
        }

        .footer {
            padding: 20px;
            border-top: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            gap: 15px;
            background: #fafafa;
            position: sticky;
            bottom: 0;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a7c2a 0%, #2d5016 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(74, 124, 42, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 124, 42, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: flex-start;
            gap: 10px;
            font-weight: 500;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }

        .alert.show {
            display: flex;
        }

        .alert i {
            margin-top: 2px;
            font-size: 18px;
            flex-shrink: 0;
        }

        .alert-error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .alert-error code {
            background: #fff;
            color: #333;
            padding: 8px;
            border-radius: 4px;
            display: block;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            border: 1px solid #ddd;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .alert-success {
            background: #efe;
            color: #2a7c2a;
            border: 1px solid #cfc;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a7c2a;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .optional-badge {
            display: inline-block;
            background: #ffa726;
            color: white;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            margin-left: 5px;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px 30px;
            color: #999;
            background: #fafafa;
            border-radius: 8px;
            border: 2px dashed #e0e0e0;
        }

        .empty-state i {
            display: block;
            font-size: 3rem;
            color: #4a7c2a;
            margin-bottom: 1rem;
        }

        #sheepData, #wheatData, #otherProjectData {
            animation: fadeIn 0.4s ease;
        }

        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 15px;
            }

            .step-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Alert -->
        <div id="alert" class="alert"></div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p style="color: #666; font-weight: 600;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</p>
        </div>

        <!-- Content -->
        <div id="mainContent">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Ø§Ù„ÙØ¦Ø©</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Ø§Ù„Ù†ÙˆØ¹</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-circle">5</div>
                    <div class="step-label">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</div>
                </div>
            </div>

            <!-- Step 1: Category -->
            <div class="step-content active" data-content="1">
                <h3 class="section-title">
                    <i class="fas fa-layer-group"></i>
                    Ø§Ø®ØªØ± ÙØ¦Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                </h3>
                <div class="category-grid">
                    <div class="category-card" data-category="animal" onclick="selectCategory('animal')">
                        <div class="category-icon">ğŸ‘</div>
                        <div class="category-name">Ø­ÙŠÙˆØ§Ù†ÙŠ</div>
                    </div>
                    <div class="category-card" data-category="plant" onclick="selectCategory('plant')">
                        <div class="category-icon">ğŸŒ¾</div>
                        <div class="category-name">Ù†Ø¨Ø§ØªÙŠ</div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Type -->
            <div class="step-content" data-content="2">
                <h3 class="section-title">
                    <i class="fas fa-tags"></i>
                    Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                </h3>
                <div id="typeList" class="type-list"></div>
            </div>

            <!-- Step 3: Basic Data -->
            <div class="step-content" data-content="3">
                <h3 class="section-title">
                    <i class="fas fa-edit"></i>
                    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                </h3>
                <div class="form-group">
                    <label><i class="fas fa-asterisk" style="color: #e74c3c; font-size: 8px;"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="projectName" placeholder="Ù…Ø«Ø§Ù„: ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£ØºÙ†Ø§Ù… 2025" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-asterisk" style="color: #e74c3c; font-size: 8px;"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø¯Ø¬)</label>
                    <input type="number" id="budget" placeholder="Ù…Ø«Ø§Ù„: 500000" step="1000">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="description" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡..."></textarea>
                </div>
            </div>

            <!-- Step 4: Project Specific Data -->
            <div class="step-content" data-content="4">
                <h3 class="section-title">
                    <i class="fas fa-clipboard-list"></i>
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                </h3>
                
                <!-- Sheep Project Data -->
                <div id="sheepData" style="display: none;">
                    <p style="background: #f0f8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #2d5016; font-size: 14px;">
                        <i class="fas fa-info-circle"></i>
                        Ø£Ø¯Ø®Ù„ Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø·ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„ÙƒÙ„ Ø­ÙŠÙˆØ§Ù† ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.
                    </p>
                    <div class="form-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¹Ø§Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ</label>
                        <input type="number" id="sheepEwesCount" placeholder="Ù…Ø«Ø§Ù„: 40" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ¨Ø§Ø´ Ø§Ù„Ø£ÙˆÙ„ÙŠ</label>
                        <input type="number" id="sheepRamsCount" placeholder="Ù…Ø«Ø§Ù„: 5" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù…Ù„Ø§Ù† Ø§Ù„Ø£ÙˆÙ„ÙŠ</label>
                        <input type="number" id="sheepLambsCount" placeholder="Ù…Ø«Ø§Ù„: 20" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ù„Ø§Ù„Ø©</label>
                        <input type="text" id="sheepBreed" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¹ÙˆØ§Ø³ÙŠØŒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                        <select id="sheepPurpose">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‡Ø¯Ù --</option>
                            <option value="meat">Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù„Ø­ÙˆÙ…</option>
                            <option value="milk">Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù„ÙŠØ¨</option>
                            <option value="both">Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ø­Ù„ÙŠØ¨</option>
                            <option value="breeding">Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªÙƒØ§Ø«Ø±</option>
                        </select>
                    </div>
                </div>

                <!-- Wheat Project Data -->
                <div id="wheatData" style="display: none;">
                    <p style="background: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #f57c00; font-size: 14px;">
                        <i class="fas fa-info-circle"></i>
                        Ø£Ø¯Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹Ø©. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.
                    </p>
                    <div class="form-group">
                        <label><i class="fas fa-asterisk" style="color: #e74c3c; font-size: 8px;"></i> Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø²Ø±ÙˆØ¹Ø© (Ù‡ÙƒØªØ§Ø±)</label>
                        <input type="number" id="wheatArea" placeholder="Ù…Ø«Ø§Ù„: 10" step="0.1" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø°ÙˆØ±</label>
                        <select id="wheatSeedType">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ --</option>
                            <option value="hard">Ù‚Ù…Ø­ ØµÙ„Ø¨</option>
                            <option value="soft">Ù‚Ù…Ø­ Ù„ÙŠÙ†</option>
                            <option value="durum">Ù‚Ù…Ø­ Ø§Ù„Ø¯ÙŠØ±Ù…</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ…ÙŠØ© Ø§Ù„Ø¨Ø°ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (ÙƒØ¬Ù…)</label>
                        <input type="number" id="wheatSeedAmount" placeholder="Ù…Ø«Ø§Ù„: 150" step="1" min="0">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ù‚Ù†Ø·Ø§Ø±/Ù‡ÙƒØªØ§Ø±)</label>
                        <input type="number" id="wheatExpectedYield" placeholder="Ù…Ø«Ø§Ù„: 40" step="0.1" min="0">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ØµØ§Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                        <input type="date" id="wheatHarvestDate">
                    </div>
                    <div class="form-group">
                        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø±ÙŠ</label>
                        <select id="wheatIrrigationMethod">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© --</option>
                            <option value="rain">Ù…Ø·Ø±ÙŠ</option>
                            <option value="sprinkler">Ø±Ø´</option>
                            <option value="drip">ØªÙ†Ù‚ÙŠØ·</option>
                            <option value="flood">ØºÙ…Ø±</option>
                        </select>
                    </div>
                </div>

                <!-- Other Projects (Coming Soon) -->
                <div id="otherProjectData" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-info-circle" style="font-size: 3rem; color: #4a7c2a; margin-bottom: 1rem;"></i>
                        <p style="color: #666; font-weight: 600;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p>
                        <p style="color: #999; font-size: 14px; margin-top: 0.5rem;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</p>
                    </div>
                </div>
            </div>

            <!-- Step 5: Resources -->
            <div class="step-content" data-content="5">
                <h3 class="section-title">
                    <i class="fas fa-link"></i>
                    Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
                    <span style="font-size: 14px; color: #999; font-weight: 400;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                </h3>
                
                <div class="form-group">
                    <label><span class="optional-badge">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span> Ø§Ù„Ø£Ø±Ø¶</label>
                    <select id="landSelect">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ø¶ --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><span class="optional-badge">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span> Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</label>
                    <div id="equipmentList" class="multi-select">
                        <div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…ØªØ§Ø­Ø©</div>
                    </div>
                </div>

                <div class="form-group">
                    <label><span class="optional-badge">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</label>
                    <div id="employeesList" class="multi-select">
                        <div class="empty-state">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ†</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()" style="display: none;">
            <i class="fas fa-arrow-right"></i>
            Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
        <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
            Ø§Ù„ØªØ§Ù„ÙŠ
            <i class="fas fa-arrow-left"></i>
        </button>
        <button class="btn btn-primary" id="saveBtn" onclick="saveProject()" style="display: none;">
            <i class="fas fa-save"></i>
            Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        </button>
    </div>

    <script>
        
        // Supabase Config
        const SUPABASE_URL = 'https://sstvsknmmhbwubzajeix.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdHZza25tbWhid3ViemFqZWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNDM0NjIsImV4cCI6MjA3NDkxOTQ2Mn0.EeVUU9DxRYUi38nUHgWEsnG8li7KZjqAGPNW9IDokhg';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Default project types
        const DEFAULT_PROJECT_TYPES = {
            animal: [
                {
                    id: 'sheep',
                    name: 'ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£ØºÙ†Ø§Ù…',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙƒØ§Ù…Ù„ Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ù‚Ø·ÙŠØ¹ Ø§Ù„Ø£ØºÙ†Ø§Ù…',
                    icon: 'ğŸ‘',
                    page: 'projects/sheep.html',
                    available: true
                },
                {
                    id: 'poultry',
                    name: 'ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ø¬Ù†',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯Ø¬Ø§Ø¬ ÙˆØ§Ù„Ø·ÙŠÙˆØ±',
                    icon: 'ğŸ”',
                    available: false
                },
                {
                    id: 'cattle',
                    name: 'ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£Ø¨Ù‚Ø§Ø±',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù„ÙŠØ¨ ÙˆØ§Ù„Ù„Ø­ÙˆÙ…',
                    icon: 'ğŸ„',
                    available: false
                }
            ],
            plant: [
                {
                    id: 'wheat',
                    name: 'Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ù‚Ù…Ø­',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ Ø²Ø±Ø§Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…Ø­ØµÙˆÙ„ Ø§Ù„Ù‚Ù…Ø­',
                    icon: 'ğŸŒ¾',
                    page: 'projects/wheat.html',
                    available: true
                },
                {
                    id: 'tomato',
                    name: 'Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø·Ù…Ø§Ø·Ù…',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø·Ù…Ø§Ø·Ù… ÙÙŠ Ø§Ù„Ø¨ÙŠÙˆØª Ø§Ù„Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠØ©',
                    icon: 'ğŸ…',
                    available: false
                },
                {
                    id: 'olive',
                    name: 'Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø²ÙŠØªÙˆÙ†',
                    description: 'Ù…Ø´Ø±ÙˆØ¹ ØºØ±Ø§Ø³Ø© ÙˆØ¥Ù†ØªØ§Ø¬ Ø§Ù„Ø²ÙŠØªÙˆÙ†',
                    icon: 'ğŸ«’',
                    available: false
                }
            ]
        };

        let currentStep = 1;
        let selectedCategory = null;
        let selectedType = null;
        let selectedEquipment = [];
        let selectedEmployees = [];
        let currentUser = null;
        let dbProjectTypes = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('%cğŸŒ¾ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯', 'color: #4a7c2a; font-size: 16px; font-weight: bold;');
            console.log('%cğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:', 'color: #f57c00; font-weight: bold;');
            console.log('Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù€ project_types Ùˆ RLSØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ SQL Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Supabase:');
            console.log('%c\n' +
                '-- Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©\n' +
                'DROP POLICY IF EXISTS "users_own_data_all_ops" ON project_types;\n\n' +
                '-- Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹\n' +
                'CREATE POLICY "allow_read_project_types" ON project_types\n' +
                'FOR SELECT USING (true);\n\n' +
                '-- Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¯Ù‚ÙŠÙ†\n' +
                'CREATE POLICY "allow_insert_project_types" ON project_types\n' +
                'FOR INSERT WITH CHECK (auth.uid() IS NOT NULL);\n',
                'background: #f5f5f5; padding: 10px; font-family: monospace; font-size: 12px;'
            );
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');
            
            await checkAuth();
            setTodayDate();
            await loadDBProjectTypes();
        });

        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                showAlert('error', 'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                setTimeout(() => {
                    if (window.parent !== window) {
                        window.parent.location.href = 'login.html';
                    } else {
                        window.location.href = '../login.html';
                    }
                }, 2000);
                return false;
            }
            currentUser = session.user;
            return true;
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
        }

        function selectCategory(category) {
            selectedCategory = category;
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('selected');
        }

        async function loadDBProjectTypes() {
            try {
                const { data, error } = await supabase
                    .from('project_types')
                    .select('*');

                if (error) throw error;

                if (data && data.length > 0) {
                    dbProjectTypes = { animal: [], plant: [] };
                    
                    data.forEach(type => {
                        if (type.category && dbProjectTypes[type.category]) {
                            dbProjectTypes[type.category].push({
                                dbId: type.id,
                                id: type.name.toLowerCase().replace(/\s+/g, '_'),
                                name: type.name,
                                description: type.meta?.description || '',
                                icon: type.meta?.icon || (type.category === 'animal' ? 'ğŸ‘' : 'ğŸŒ¾'),
                                page: type.meta?.page || null,
                                available: true
                            });
                        }
                    });
                    
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', dbProjectTypes);
                }
            } catch (error) {
                console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', error.message);
            }
        }

        function loadProjectTypes() {
            const typeList = document.getElementById('typeList');
            typeList.innerHTML = '';

            if (!selectedCategory) {
                typeList.innerHTML = '<div class="empty-state">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹</div>';
                return;
            }

            let types = (dbProjectTypes[selectedCategory] && dbProjectTypes[selectedCategory].length > 0) 
                ? dbProjectTypes[selectedCategory] 
                : (DEFAULT_PROJECT_TYPES[selectedCategory] || []);

            if (types.length === 0) {
                typeList.innerHTML = '<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©</div>';
                return;
            }

            types.forEach(type => {
                const typeItem = document.createElement('div');
                typeItem.className = `type-item ${!type.available ? 'coming-soon' : ''}`;
                
                if (type.available) {
                    typeItem.onclick = () => selectType(type, typeItem);
                }

                typeItem.innerHTML = `
                    <div class="type-icon">${type.icon}</div>
                    <div class="type-info">
                        <h3>${type.name}</h3>
                        <p>${type.description}</p>
                    </div>
                `;
                typeList.appendChild(typeItem);
            });
        }

        function selectType(type, element) {
            if (!type.available) return;
            
            selectedType = type;
            document.querySelectorAll('.type-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        async function loadResources() {
            await Promise.all([
                loadLands(),
                loadEquipment(),
                loadEmployees()
            ]);
        }

        async function loadLands() {
            try {
                const { data, error } = await supabase
                    .from('lands')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                const select = document.getElementById('landSelect');
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ø¶ --</option>';
                
                if (data && data.length > 0) {
                    data.forEach(land => {
                        const option = document.createElement('option');
                        option.value = land.id;
                        const statusText = land.status === 'available' ? '' : ` (${land.status})`;
                        option.textContent = `${land.name} - ${land.area} Ù‡ÙƒØªØ§Ø±${statusText}`;
                        if (land.status !== 'available') {
                            option.disabled = true;
                            option.style.color = '#999';
                        }
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ:', error);
            }
        }

        async function loadEquipment() {
            try {
                const { data, error } = await supabase
                    .from('equipment')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                const list = document.getElementById('equipmentList');
                list.innerHTML = '';
                
                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fas fa-tractor"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª Ù…ØªØ§Ø­Ø©</p></div>';
                    return;
                }

                data.forEach(equipment => {
                    const item = document.createElement('div');
                    item.className = 'multi-select-item';
                    const statusBadge = equipment.status !== 'active' ? ` <span style="color: #999;">(${equipment.status})</span>` : '';
                    item.innerHTML = `<i class="fas fa-tractor"></i> ${equipment.name} - ${equipment.type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}${statusBadge}`;
                    
                    if (equipment.status === 'active') {
                        item.onclick = () => toggleSelection(item, equipment.id, selectedEquipment);
                    } else {
                        item.style.opacity = '0.5';
                        item.style.cursor = 'not-allowed';
                    }
                    
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª:', error);
            }
        }

        async function loadEmployees() {
            try {
                const { data, error } = await supabase
                    .from('employees')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                const list = document.getElementById('employeesList');
                list.innerHTML = '';
                
                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ†</p></div>';
                    return;
                }

                data.forEach(employee => {
                    const item = document.createElement('div');
                    item.className = 'multi-select-item';
                    const statusBadge = employee.status !== 'active' ? ` <span style="color: #999;">(${employee.status})</span>` : '';
                    item.innerHTML = `<i class="fas fa-user"></i> ${employee.name} - ${employee.position || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}${statusBadge}`;
                    
                    if (employee.status === 'active') {
                        item.onclick = () => toggleSelection(item, employee.id, selectedEmployees);
                    } else {
                        item.style.opacity = '0.5';
                        item.style.cursor = 'not-allowed';
                    }
                    
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
            }
        }

        function toggleSelection(element, id, array) {
            element.classList.toggle('selected');
            const index = array.indexOf(id);
            if (index > -1) {
                array.splice(index, 1);
            } else {
                array.push(id);
            }
        }

        function nextStep() {
            if (currentStep === 1 && !selectedCategory) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
                return;
            }

            if (currentStep === 2 && !selectedType) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
                return;
            }

            if (currentStep === 3) {
                const name = document.getElementById('projectName').value.trim();
                const startDate = document.getElementById('startDate').value;
                
                if (!name) {
                    showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
                    return;
                }
                if (!startDate) {
                    showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡');
                    return;
                }
            }

            if (currentStep === 4) {
                if (selectedType.id === 'wheat' || selectedType.name?.includes('Ù‚Ù…Ø­')) {
                    const area = document.getElementById('wheatArea').value;
                    if (!area || parseFloat(area) <= 0) {
                        showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø²Ø±ÙˆØ¹Ø©');
                        return;
                    }
                }
            }

            if (currentStep < 5) {
                currentStep++;
                updateSteps();

                if (currentStep === 2) {
                    loadProjectTypes();
                }

                if (currentStep === 4) {
                    loadProjectSpecificData();
                }

                if (currentStep === 5) {
                    loadResources();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        }

        function loadProjectSpecificData() {
            document.getElementById('sheepData').style.display = 'none';
            document.getElementById('wheatData').style.display = 'none';
            document.getElementById('otherProjectData').style.display = 'none';

            if (!selectedType) {
                document.getElementById('otherProjectData').style.display = 'block';
                return;
            }

            const typeId = selectedType.id || '';
            const typeName = selectedType.name || '';

            if (typeId === 'sheep' || typeName.includes('Ø£ØºÙ†Ø§Ù…') || typeName.includes('ØºÙ†Ø§Ù…')) {
                document.getElementById('sheepData').style.display = 'block';
            } else if (typeId === 'wheat' || typeName.includes('Ù‚Ù…Ø­')) {
                document.getElementById('wheatData').style.display = 'block';
            } else {
                document.getElementById('otherProjectData').style.display = 'block';
            }
        }

        function updateSteps() {
            document.querySelectorAll('.step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                if (stepNum === currentStep) {
                    step.classList.add('active');
                } else if (stepNum < currentStep) {
                    step.classList.add('completed');
                }
            });

            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector(`[data-content="${currentStep}"]`).classList.add('active');

            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const saveBtn = document.getElementById('saveBtn');

            prevBtn.style.display = currentStep === 1 ? 'none' : 'flex';
            nextBtn.style.display = currentStep === 5 ? 'none' : 'flex';
            saveBtn.style.display = currentStep === 5 ? 'flex' : 'none';
        }

        async function saveProject() {
            const loading = document.getElementById('loading');
            const mainContent = document.getElementById('mainContent');
            
            loading.classList.add('show');
            mainContent.style.display = 'none';

            try {
                console.clear(); // Ù…Ø³Ø­ Console Ù„Ù„ÙˆØ¶ÙˆØ­
                console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #4a7c2a; font-weight: bold;');
                console.log('%cğŸŒ¾ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', 'color: #4a7c2a; font-size: 16px; font-weight: bold;');
                console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #4a7c2a; font-weight: bold;');
                console.log('');
                
                // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                console.log('ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', currentUser.email);
                console.log('ğŸ†” User ID:', currentUser.id);
                console.log('');
                
                // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                console.log('ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:');
                console.log('   Ø§Ù„ÙØ¦Ø©:', selectedCategory);
                console.log('   Ø§Ù„Ù†ÙˆØ¹:', selectedType.name);
                console.log('   Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©:', selectedType.icon);
                console.log('   Ø§Ù„ØµÙØ­Ø©:', selectedType.page);
                console.log('');
                
                // ========== 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (project_types) ==========
                console.log('%câ”â”â” Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (project_types) â”â”â”', 'color: #2196F3; font-weight: bold;');
                
                let typeId = selectedType.dbId || null;
                console.log('ğŸ” Type ID Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©:', typeId);
                
                if (!typeId) {
                    console.log('â© Ù„Ø§ ÙŠÙˆØ¬Ø¯ Type IDØŒ Ø³Ù†Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    console.log('');
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†ÙˆØ¹
                    console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†ÙˆØ¹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    console.log('   Ø§Ù„Ø§Ø³Ù…:', selectedType.name);
                    console.log('   Ø§Ù„ÙØ¦Ø©:', selectedCategory);
                    
                    const { data: existingTypes, error: searchError } = await supabase
                        .from('project_types')
                        .select('*')
                        .eq('name', selectedType.name)
                        .eq('category', selectedCategory);
                    
                    console.log('');
                    console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«:');
                    console.table(existingTypes);
                    
                    if (searchError) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', searchError);
                    }
                    
                    if (existingTypes && existingTypes.length > 0) {
                        // Ø§Ù„Ù†ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯
                        typeId = existingTypes[0].id;
                        console.log('');
                        console.log('%câœ… Ø§Ù„Ù†ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!', 'color: #4CAF50; font-weight: bold; font-size: 14px;');
                        console.log('   ID:', typeId);
                        console.log('   Ø§Ù„Ø§Ø³Ù…:', existingTypes[0].name);
                        console.log('   ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:', existingTypes[0].created_at);
                        console.log('');
                        console.log('âœ… Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯');
                    } else {
                        // Ø§Ù„Ù†ÙˆØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¤Ù‡
                        console.log('');
                        console.log('%câŒ Ø§Ù„Ù†ÙˆØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'color: #FF9800; font-weight: bold;');
                        console.log('');
                        console.log('%câ• Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù†ÙˆØ¹ Ø¬Ø¯ÙŠØ¯...', 'color: #2196F3; font-weight: bold;');
                        
                        const newTypeData = {
                            name: selectedType.name,
                            category: selectedCategory,
                            meta: {
                                description: selectedType.description || '',
                                icon: selectedType.icon || 'ğŸ“‹',
                                page: selectedType.page || null
                            }
                        };
                        
                        console.log('');
                        console.log('ğŸ“¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¯Ø®Ø§Ù„Ù‡Ø§:');
                        console.log(JSON.stringify(newTypeData, null, 2));
                        console.log('');
                        
                        const { data: insertedType, error: insertError } = await supabase
                            .from('project_types')
                            .insert([newTypeData])
                            .select();
                        
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        console.log('ğŸ“¥ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:');
                        
                        if (insertError) {
                            console.log('');
                            console.log('%câŒâŒâŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ÙˆØ¹! âŒâŒâŒ', 'background: #f44336; color: white; padding: 5px; font-weight: bold; font-size: 14px;');
                            console.log('');
                            console.error('Ø§Ù„Ø®Ø·Ø£:', insertError);
                            console.error('Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', insertError.message);
                            console.error('Ø§Ù„ÙƒÙˆØ¯:', insertError.code);
                            console.error('Ø§Ù„ØªÙØ§ØµÙŠÙ„:', insertError.details);
                            console.error('Ø§Ù„ØªÙ„Ù…ÙŠØ­:', insertError.hint);
                            console.log('');
                            
                            if (insertError.message.includes('row-level security') || 
                                insertError.message.includes('permission') ||
                                insertError.code === '42501') {
                                console.log('%câš ï¸âš ï¸âš ï¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: ØµÙ„Ø§Ø­ÙŠØ§Øª RLS âš ï¸âš ï¸âš ï¸', 'background: #ff9800; color: white; padding: 5px; font-weight: bold;');
                                console.log('');
                                console.log('ğŸ”§ Ø§Ù„Ø­Ù„: Ø§ÙØªØ­ Supabase SQL Editor ÙˆÙ†ÙØ°:');
                                console.log('');
                                console.log('%c' +
                                    'DROP POLICY IF EXISTS "authenticated_insert_project_types" ON project_types;\n\n' +
                                    'CREATE POLICY "authenticated_insert_project_types" ON project_types\n' +
                                    'FOR INSERT TO authenticated WITH CHECK (true);',
                                    'background: #f5f5f5; color: #000; padding: 10px; font-family: monospace; font-size: 12px;'
                                );
                                console.log('');
                            }
                            
                            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ' + insertError.message);
                        }
                        
                        if (insertedType && insertedType.length > 0) {
                            typeId = insertedType[0].id;
                            console.log('');
                            console.log('%câœ…âœ…âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­! âœ…âœ…âœ…', 'background: #4CAF50; color: white; padding: 5px; font-weight: bold; font-size: 14px;');
                            console.log('');
                            console.table(insertedType);
                            console.log('');
                            console.log('ğŸ‰ ID Ø§Ù„Ø¬Ø¯ÙŠØ¯:', typeId);
                        } else {
                            console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª!');
                            throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ID Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡');
                        }
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    }
                } else {
                    console.log('âœ… ÙŠÙˆØ¬Ø¯ Type ID Ù…Ø³Ø¨Ù‚Ø§Ù‹:', typeId);
                }
                
                console.log('');
                console.log('%cğŸ¯ Type ID Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ' + typeId, 'background: #4a7c2a; color: white; padding: 5px; font-weight: bold;');
                console.log('');
                
                // ========== 2. Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (projects) ==========
                console.log('%câ”â”â” Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (projects) â”â”â”', 'color: #2196F3; font-weight: bold;');
                
                const projectData = {
                    user_id: currentUser.id,
                    type_id: typeId,
                    name: document.getElementById('projectName').value.trim(),
                    start_date: document.getElementById('startDate').value,
                    budget: parseFloat(document.getElementById('budget').value) || null,
                    description: document.getElementById('description').value.trim() || null,
                    status: 'active'
                };
                
                console.log('ğŸ“¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:');
                console.table(projectData);

                const { data: project, error: projectError } = await supabase
                    .from('projects')
                    .insert([projectData])
                    .select()
                    .single();

                if (projectError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:', projectError);
                    throw projectError;
                }
                
                console.log('');
                console.log('%câœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!', 'background: #4CAF50; color: white; padding: 5px; font-weight: bold;');
                console.log('ğŸ†” Project ID:', project.id);
                console.log('ğŸ“› Ø§Ù„Ø§Ø³Ù…:', project.name);
                console.log('');

                // ========== 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ==========
                await saveProjectSpecificData(project.id);

                // ========== 4. Ø±Ø¨Ø· Ø§Ù„Ø£Ø±Ø¶ (project_lands) ==========
                const landId = document.getElementById('landSelect').value;
                if (landId) {
                    console.log('ğŸŒ Ø±Ø¨Ø· Ø§Ù„Ø£Ø±Ø¶...');
                    await supabase.from('project_lands').insert([{
                        user_id: currentUser.id,
                        project_id: project.id,
                        land_id: landId,
                        start_date: projectData.start_date,
                        usage_type: 'primary'
                    }]);

                    await supabase.from('lands').update({ status: 'in_use' }).eq('id', landId);
                    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø£Ø±Ø¶');
                }

                // ========== 5. Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª (project_equipment) ==========
                if (selectedEquipment.length > 0) {
                    console.log('ğŸšœ Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª:', selectedEquipment.length);
                    await supabase.from('project_equipment').insert(
                        selectedEquipment.map(eqId => ({
                            user_id: currentUser.id,
                            project_id: project.id,
                            equipment_id: eqId,
                            start_date: projectData.start_date,
                            status: 'active'
                        }))
                    );
                    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ø¯Ø§Øª');
                }

                // ========== 6. Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (project_employees) ==========
                if (selectedEmployees.length > 0) {
                    console.log('ğŸ‘¥ Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', selectedEmployees.length);
                    await supabase.from('project_employees').insert(
                        selectedEmployees.map(empId => ({
                            user_id: currentUser.id,
                            project_id: project.id,
                            employee_id: empId,
                            start_date: projectData.start_date,
                            status: 'active'
                        }))
                    );
                    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                }

                console.log('ğŸ‰ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­!');
                showAlert('success', 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!');
                
                if (window.parent !== window) {
                    window.parent.postMessage({ type: 'projectAdded', projectId: project.id }, '*');
                }

                setTimeout(() => {
    let redirectUrl = '';
    
    if (selectedType.page) {
        redirectUrl = selectedType.page; // âœ… Ø¨Ø¯ÙˆÙ† ../
    } else {
        redirectUrl = '../index.html';
    }

    const finalUrl = redirectUrl.includes('index.html') 
        ? redirectUrl 
        : `${redirectUrl}?id=${project.id}`;

    console.log('ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:', finalUrl);
    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...');
    
    if (window.parent !== window) {
        window.parent.location.href = finalUrl;
    } else {
        window.location.href = finalUrl; // âœ… ØµØ­ÙŠØ­ Ø§Ù„Ø¢Ù†
    }
}, 1500);

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:', error);
                console.error('ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', {
                    message: error.message,
                    code: error.code,
                    details: error.details,
                    hint: error.hint
                });
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
                
                if (error.message.includes('project_types') && error.message.includes('row-level security')) {
                    errorMessage = `
                        <strong>Ø®Ø·Ø£ ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¬Ø¯ÙˆÙ„ project_types</strong><br>
                        <small>ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ SQL Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Supabase:</small><br>
                        <code style="display:block;background:#f5f5f5;padding:10px;margin-top:5px;border-radius:4px;font-size:12px;direction:ltr;text-align:left;">
                        -- Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©<br>
                        DROP POLICY IF EXISTS "users_own_data_all_ops" ON project_types;<br><br>
                        -- Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹<br>
                        CREATE POLICY "allow_read_project_types" ON project_types<br>
                        FOR SELECT USING (true);<br><br>
                        -- Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¯Ù‚ÙŠÙ†<br>
                        CREATE POLICY "allow_insert_project_types" ON project_types<br>
                        FOR INSERT WITH CHECK (auth.uid() IS NOT NULL);
                        </code>
                    `;
                } else if (error.message.includes('violates row-level security')) {
                    errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
                } else if (error.message.includes('projects')) {
                    errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ' + error.message;
                } else {
                    errorMessage = error.message;
                }
                
                showAlert('error', errorMessage);
                loading.classList.remove('show');
                mainContent.style.display = 'block';
            }
        }

        async function saveProjectSpecificData(projectId) {
            const typeId = selectedType.id || '';
            const typeName = selectedType.name || '';

            // ========== Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø£ØºÙ†Ø§Ù… ==========
            if (typeId === 'sheep' || typeName.includes('Ø£ØºÙ†Ø§Ù…') || typeName.includes('ØºÙ†Ø§Ù…')) {
                console.log('ğŸ‘ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù…...');
                
                const ewesCount = parseInt(document.getElementById('sheepEwesCount').value) || 0;
                const ramsCount = parseInt(document.getElementById('sheepRamsCount').value) || 0;
                const lambsCount = parseInt(document.getElementById('sheepLambsCount').value) || 0;
                const breed = document.getElementById('sheepBreed').value.trim();
                const purpose = document.getElementById('sheepPurpose').value;

                const animals = [];
                const timestamp = Date.now();

                for (let i = 1; i <= ewesCount; i++) {
                    animals.push({
                        user_id: currentUser.id,
                        project_id: projectId,
                        tag_number: `EWE-${timestamp}-${String(i).padStart(3, '0')}`,
                        type: 'ewe',
                        sex: 'F',
                        status: 'active',
                        health_json: { breed: breed || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', purpose: purpose || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', initial_animal: true }
                    });
                }

                for (let i = 1; i <= ramsCount; i++) {
                    animals.push({
                        user_id: currentUser.id,
                        project_id: projectId,
                        tag_number: `RAM-${timestamp}-${String(i).padStart(3, '0')}`,
                        type: 'ram',
                        sex: 'M',
                        status: 'active',
                        health_json: { breed: breed || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', purpose: purpose || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', initial_animal: true }
                    });
                }

                for (let i = 1; i <= lambsCount; i++) {
                    animals.push({
                        user_id: currentUser.id,
                        project_id: projectId,
                        tag_number: `LAMB-${timestamp}-${String(i).padStart(3, '0')}`,
                        type: 'lamb',
                        sex: i % 2 === 0 ? 'M' : 'F',
                        birth_date: new Date().toISOString().split('T')[0],
                        status: 'active',
                        health_json: { breed: breed || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', purpose: purpose || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', initial_animal: true }
                    });
                }

                if (animals.length > 0) {
                    await supabase.from('sheep_animals').insert(animals);
                    console.log('âœ… ØªÙ… Ø­ÙØ¸', animals.length, 'Ø­ÙŠÙˆØ§Ù†');
                }
            }
            
            // ========== Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù‚Ù…Ø­ ==========
            else if (typeId === 'wheat' || typeName.includes('Ù‚Ù…Ø­')) {
                console.log('ğŸŒ¾ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ù…Ø­...');
                
                const area = parseFloat(document.getElementById('wheatArea').value) || 0;
                const seedType = document.getElementById('wheatSeedType').value;
                const expectedYield = parseFloat(document.getElementById('wheatExpectedYield').value) || 0;
                const harvestDate = document.getElementById('wheatHarvestDate').value;
                const irrigationMethod = document.getElementById('wheatIrrigationMethod').value;

                const stages = [
                    { stage_name: 'Ø§Ù„Ø­Ø±Ø« ÙˆØ§Ù„ØªØ¬Ù‡ÙŠØ²', status: 'pending' },
                    { stage_name: 'Ø§Ù„Ø¨Ø°Ø±', status: 'pending' },
                    { stage_name: 'Ø§Ù„ØªØ³Ù…ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„', status: 'pending' },
                    { stage_name: 'Ø§Ù„Ø±ÙŠ Ø§Ù„Ø£ÙˆÙ„', status: 'pending' },
                    { stage_name: 'Ø§Ù„ØªØ³Ù…ÙŠØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ', status: 'pending' },
                    { stage_name: 'Ø§Ù„Ø±ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ', status: 'pending' },
                    { stage_name: 'Ø§Ù„Ù…ÙƒØ§ÙØ­Ø©', status: 'pending' },
                    { stage_name: 'Ø§Ù„Ø­ØµØ§Ø¯', status: 'pending' }
                ];

                await supabase.from('wheat_project_stages').insert(
                    stages.map(stage => ({
                        user_id: currentUser.id,
                        project_id: projectId,
                        stage_name: stage.stage_name,
                        status: stage.status,
                        notes: `Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${area} Ù‡ÙƒØªØ§Ø± | Ø§Ù„Ø¨Ø°ÙˆØ±: ${seedType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | Ø§Ù„Ø±ÙŠ: ${irrigationMethod || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`
                    }))
                );

                if (harvestDate && expectedYield > 0) {
                    await supabase.from('wheat_harvest').insert([{
                        user_id: currentUser.id,
                        project_id: projectId,
                        harvest_date: harvestDate,
                        total_yield: expectedYield * area,
                        yield_unit: 'quintal',
                        notes: `Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${expectedYield} Ù‚Ù†Ø·Ø§Ø±/Ù‡ÙƒØªØ§Ø±`
                    }]);
                }
                
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù‚Ù…Ø­');
            }
        }

        function showAlert(type, message) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type} show`;
            
            if (message.includes('<br>')) {
                alert.innerHTML = `
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                    <div style="flex: 1;">${message}</div>
                `;
            } else {
                alert.innerHTML = `
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                    ${message}
                `;
            }
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // ========== Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± (ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„Ù‡Ø§ Ù…Ù† Console) ==========
        window.testProjectTypeInsert = async function() {
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯...');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            
            if (!currentUser) {
                console.error('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }
            
            console.log('âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', currentUser.email);
            
            const testData = {
                name: 'Ø§Ø®ØªØ¨Ø§Ø± - ' + Date.now(),
                category: 'animal',
                meta: {
                    description: 'Ù…Ø´Ø±ÙˆØ¹ Ø§Ø®ØªØ¨Ø§Ø±',
                    icon: 'ğŸ§ª',
                    page: null
                }
            };
            
            console.log('ğŸ“¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', testData);
            
            try {
                const { data, error } = await supabase
                    .from('project_types')
                    .insert([testData])
                    .select();
                
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                if (error) {
                    console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„!');
                    console.error('Ø§Ù„Ø®Ø·Ø£:', error);
                    console.error('Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error.message);
                    console.error('Ø§Ù„ÙƒÙˆØ¯:', error.code);
                } else {
                    console.log('âœ…âœ…âœ… Ù†Ø¬Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„! âœ…âœ…âœ…');
                    console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data);
                    
                    // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    if (data && data[0]) {
                        await supabase.from('project_types').delete().eq('id', data[0].id);
                        console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                    }
                }
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            } catch (e) {
                console.error('âŒ Ø®Ø·Ø£:', e);
            }
        };
        
        console.log('%cğŸ’¡ Ù†ØµÙŠØ­Ø©: Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ø§ÙƒØªØ¨ ÙÙŠ Console:', 'color: #4a7c2a; font-weight: bold;');
        console.log('%ctestProjectTypeInsert()', 'background: #f5f5f5; padding: 5px; font-family: monospace;');
    </script>
</body>
</html>
