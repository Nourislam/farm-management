<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ•ÿØÿßÿ±ÿ© ŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿ±ÿ®Ÿäÿ© ÿßŸÑÿ£ÿ∫ŸÜÿßŸÖ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; direction: rtl; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #5d4037 0%, #8d6e63 100%); color: white; padding: 20px 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(93, 64, 55, 0.3); }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .project-title { display: flex; align-items: center; gap: 15px; }
        .project-title h1 { font-size: 28px; font-weight: 700; }
        .project-icon { font-size: 40px; }
        .project-status { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: 600; }
        .status-active { background: #4caf50; color: white; }
        .status-inactive { background: #ff9800; color: white; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Cairo', sans-serif; font-weight: 600; font-size: 14px; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: #5d4037; color: white; }
        .btn-primary:hover { background: #4e342e; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(93, 64, 55, 0.4); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-sm { padding: 5px 12px; font-size: 12px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 4px 20px rgba(0,0,0,0.12); }
        .stat-card-header { display: flex; justify-content: space-between; align-items: center; }
        .stat-card-icon { font-size: 32px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .stat-card-title { font-size: 14px; color: #6c757d; font-weight: 600; }
        .stat-card-value { font-size: 32px; font-weight: 700; color: #5d4037; margin: 10px 0; }
        .stat-card-subtitle { font-size: 12px; color: #6c757d; }
        .tabs { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 30px; }
        .tab-header { display: flex; background: #f8f9fa; border-bottom: 2px solid #e0e0e0; overflow-x: auto; }
        .tab-button { padding: 15px 25px; background: none; border: none; cursor: pointer; font-family: 'Cairo', sans-serif; font-weight: 600; font-size: 14px; color: #6c757d; transition: all 0.3s; white-space: nowrap; }
        .tab-button.active { background: white; color: #5d4037; border-bottom: 3px solid #5d4037; }
        .tab-button:hover:not(.active) { background: #e9ecef; }
        .tab-content { padding: 30px; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); animation: fadeIn 0.3s; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 15px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2); animation: slideDown 0.3s; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { padding: 20px 25px; background: #5d4037; color: white; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 20px; font-weight: 700; }
        .modal-close { background: none; border: none; color: white; font-size: 28px; cursor: pointer; line-height: 1; padding: 0; width: 30px; height: 30px; }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; background: #f8f9fa; border-radius: 0 0 15px 15px; display: flex; justify-content: flex-end; gap: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px; }
        .form-control { width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: 'Cairo', sans-serif; font-size: 14px; transition: border-color 0.3s; }
        .form-control:focus { outline: none; border-color: #5d4037; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        select.form-control { cursor: pointer; }
        textarea.form-control { resize: vertical; min-height: 100px; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; }
        thead { background: #f8f9fa; }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #e0e0e0; }
        th { font-weight: 700; color: #5d4037; font-size: 14px; }
        td { font-size: 13px; }
        tbody tr:hover { background: #f8f9fa; }
        .filters-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; }
        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .spinner { width: 60px; height: 60px; border: 6px solid #f0f0f0; border-top: 6px solid #5d4037; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-secondary { background: #e2e3e5; color: #383d41; }
        .badge-info { background: #d1ecf1; color: #0c5460; }
        .info-box { background: #e3f2fd; border: 1px solid #90caf9; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .info-box p { margin: 5px 0; font-size: 13px; }
        .material-item { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 10px; }
        .material-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .alert { padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: none; animation: fadeIn 0.3s; }
        .alert.show { display: block; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        @media (max-width: 768px) {
            .header-content { flex-direction: column; align-items: flex-start; }
            .stats-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .filters-row { grid-template-columns: 1fr; }
            .modal-content { width: 95%; }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: #5d4037; font-weight: 600;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
    </div>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="project-title">
                    <span class="project-icon">üêë</span>
                    <div>
                        <h1 id="projectName">ŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿ±ÿ®Ÿäÿ© ÿßŸÑÿ£ÿ∫ŸÜÿßŸÖ</h1>
                        <span id="projectStatus" class="project-status status-active">ŸÜÿ¥ÿ∑</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-info btn-sm" onclick="window.location.href='index.html'">üè† ÿßŸÑÿ±ÿ¨Ÿàÿπ ŸÑŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
                    <button class="btn btn-warning btn-sm" onclick="editProject()">‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</button>
                    <button class="btn btn-warning btn-sm" id="toggleStatusBtn" onclick="toggleProjectStatus()">‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteProject()">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button>
                </div>
            </div>
        </div>
        <div id="successAlert" class="alert alert-success"></div>
        <div id="errorAlert" class="alert alert-danger"></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-card-header"><div><div class="stat-card-title">ÿßŸÑŸÜÿπÿßÿ¨</div><div class="stat-card-value" id="ewesCount">0</div><div class="stat-card-subtitle">ÿ•ŸÜÿßÿ´ ÿ®ÿßŸÑÿ∫ÿ©</div></div><div class="stat-card-icon" style="background: #fce4ec; color: #e91e63;">üêë</div></div></div>
            <div class="stat-card"><div class="stat-card-header"><div><div class="stat-card-title">ÿßŸÑÿ≠ŸÖŸÑÿßŸÜ</div><div class="stat-card-value" id="lambsCount">0</div><div class="stat-card-subtitle">ÿµÿ∫ÿßÿ± (ÿ£ŸÇŸÑ ŸÖŸÜ ÿ≥ŸÜÿ©)</div></div><div class="stat-card-icon" style="background: #fff3e0; color: #ff9800;">üêè</div></div></div>
            <div class="stat-card"><div class="stat-card-header"><div><div class="stat-card-title">ÿßŸÑŸÉÿ®ÿßÿ¥</div><div class="stat-card-value" id="ramsCount">0</div><div class="stat-card-subtitle">ÿ∞ŸÉŸàÿ± ÿ®ÿßŸÑÿ∫ÿ©</div></div><div class="stat-card-icon" style="background: #e3f2fd; color: #2196f3;">üêè</div></div></div>
            <div class="stat-card"><div class="stat-card-header"><div><div class="stat-card-title">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</div><div class="stat-card-value" id="totalCount">0</div><div class="stat-card-subtitle">ÿßŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™ ÿßŸÑÿ≠Ÿäÿ©</div></div><div class="stat-card-icon" style="background: #f3e5f5; color: #9c27b0;">üêë</div></div></div>
        </div>
        <div class="tabs">
            <div class="tab-header">
                <button class="tab-button active" onclick="showTab('animals')">üêë ÿßŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™</button>
                <button class="tab-button" onclick="showTab('health')">üíâ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ©</button>
                <button class="tab-button" onclick="showTab('births')">üë∂ ÿßŸÑŸàŸÑÿßÿØÿßÿ™</button>
                <button class="tab-button" onclick="showTab('feeding')">üåæ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©</button>
                <button class="tab-button" onclick="showTab('sales')">üí∞ ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™</button>
                <button class="tab-button" onclick="showTab('loans')">üéÅ ŸÇÿ±Ÿàÿ∂ ÿßŸÑÿπŸäÿØ</button>
                <button class="tab-button" onclick="showTab('expenses')">üí∏ ÿßŸÑŸÖÿµÿßÿ±ŸäŸÅ</button>
            </div>
            <div id="animalsTab" class="tab-content tab-pane active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üêë ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™</h3>
                    <button class="btn btn-primary" onclick="openAddAnimalModal()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸäŸàÿßŸÜ</button>
                </div>
                <div class="filters-row">
                    <div class="form-group"><label class="form-label">ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ŸäŸàÿßŸÜ</label><select class="form-control" id="filterStatus" onchange="loadAnimals()"><option value="">ÿßŸÑŸÉŸÑ</option><option value="alive" selected>ÿ≠Ÿä</option><option value="sold">ŸÖÿ®ÿßÿπ</option><option value="died">ŸÜÿßŸÅŸÇ</option><option value="slaughtered">ŸÖÿ∞ÿ®Ÿàÿ≠</option></select></div>
                    <div class="form-group"><label class="form-label">ÿßŸÑÿ¨ŸÜÿ≥</label><select class="form-control" id="filterSex" onchange="loadAnimals()"><option value="">ÿßŸÑŸÉŸÑ</option><option value="male">ÿ∞ŸÉÿ±</option><option value="female">ÿ£ŸÜÿ´Ÿâ</option></select></div>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿ±ŸÇŸÖ ÿßŸÑÿπŸÑÿßŸÖÿ©</th><th>ÿßŸÑŸÜŸàÿπ</th><th>ÿßŸÑÿ¨ŸÜÿ≥</th><th>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ</th><th>ÿßŸÑÿπŸÖÿ±</th><th>ÿßŸÑŸàÿ≤ŸÜ (ŸÉÿ¨ŸÖ)</th><th>ÿßŸÑÿ≠ÿßŸÑÿ©</th><th>ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿµÿ≠Ÿäÿ©</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="animalsTableBody"><tr><td colspan="9" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="healthTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üíâ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ©</h3>
                    <button class="btn btn-primary" onclick="openAddHealthRecordModal()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑ ÿµÿ≠Ÿä</button>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th><th>ÿ±ŸÇŸÖ ÿßŸÑÿπŸÑÿßŸÖÿ©</th><th>ŸÜŸàÿπ ÿßŸÑÿ≥ÿ¨ŸÑ</th><th>ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</th><th>ÿßŸÑÿ∑ÿ®Ÿäÿ® ÿßŸÑÿ®Ÿäÿ∑ÿ±Ÿä</th><th>ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</th><th>ÿßŸÑŸÖŸàÿπÿØ ÿßŸÑÿ™ÿßŸÑŸä</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="healthTableBody"><tr><td colspan="8" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="birthsTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üë∂ ÿ≥ÿ¨ŸÑ ÿßŸÑŸàŸÑÿßÿØÿßÿ™</h3>
                    <button class="btn btn-primary" onclick="openAddBirthModal()">‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ŸàŸÑÿßÿØÿ©</button>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸàŸÑÿßÿØÿ©</th><th>ÿßŸÑÿ£ŸÖ</th><th>ÿßŸÑÿ£ÿ®</th><th>ÿπÿØÿØ ÿßŸÑŸÖŸàÿßŸÑŸäÿØ</th><th>ÿßŸÑÿ£ÿ≠Ÿäÿßÿ°</th><th>ÿßŸÑŸàŸÅŸäÿßÿ™</th><th>ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸàÿ≤ŸÜ</th><th>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="birthsTableBody"><tr><td colspan="9" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="feedingTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üåæ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©</h3>
                    <button class="btn btn-primary" onclick="openAddFeedingModal()">‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ÿ∫ÿ∞Ÿäÿ©</button>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th><th>ÿπÿØÿØ ÿßŸÑÿ±ÿ§Ÿàÿ≥</th><th>ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ©</th><th>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©</th><th>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</th><th>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="feedingTableBody"><tr><td colspan="7" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="salesTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üí∞ ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™</h3>
                    <button class="btn btn-primary" onclick="openAddSaleModal()">‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®Ÿäÿπ</button>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th><th>ŸÜŸàÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨</th><th>ÿßŸÑŸàÿµŸÅ</th><th>ÿßŸÑŸÉŸÖŸäÿ©</th><th>ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</th><th>ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä</th><th>ÿ≠ÿßŸÑÿ© ÿßŸÑÿØŸÅÿπ</th><th>ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="salesTableBody"><tr><td colspan="9" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="loansTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üéÅ ŸÇÿ±Ÿàÿ∂ ÿßŸÑÿπŸäÿØ</h3>
                    <button class="btn btn-primary" onclick="openAddLoanModal()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ±ÿ∂</button>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th><th>ÿßŸÑŸÖŸÇÿ™ÿ±ÿ∂</th><th>ÿßŸÑŸáÿßÿ™ŸÅ</th><th>ÿ±ŸÇŸÖ ÿßŸÑÿπŸÑÿßŸÖÿ©</th><th>ÿßŸÑŸÇŸäŸÖÿ©</th><th>ÿßŸÑŸÖÿØŸÅŸàÿπ</th><th>ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</th><th>ÿßŸÑÿ≠ÿßŸÑÿ©</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="loansTableBody"><tr><td colspan="9" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
            <div id="expensesTab" class="tab-content tab-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #5d4037;">üí∏ ÿßŸÑŸÖÿµÿßÿ±ŸäŸÅ</h3>
                    <button class="btn btn-primary" onclick="openAddExpenseModal()">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ</button>
                </div>
                <div class="filters-row">
                    <div class="form-group"><label class="form-label">ÿßŸÑŸÅÿ¶ÿ©</label><select class="form-control" id="filterExpenseCategory" onchange="loadExpenses()"><option value="">ÿßŸÑŸÉŸÑ</option><option value="feeding">ÿ™ÿ∫ÿ∞Ÿäÿ©</option><option value="health">ÿµÿ≠ÿ©</option><option value="labor">ÿ£ÿ¨Ÿàÿ± ÿπŸÖÿßŸÑ</option><option value="cleaning">ÿ™ŸÜÿ∏ŸäŸÅ</option><option value="sterilization">ÿ™ÿπŸÇŸäŸÖ</option><option value="maintenance">ÿµŸäÿßŸÜÿ©</option><option value="other">ÿ£ÿÆÿ±Ÿâ</option></select></div>
                </div>
                <div class="table-container"><table><thead><tr><th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th><th>ÿßŸÑŸÅÿ¶ÿ©</th><th>ÿßŸÑŸàÿµŸÅ</th><th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th><th>ÿßŸÑŸÖÿ≥ÿ™ŸÅŸäÿØ</th><th>ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ</th><th>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</th><th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th></tr></thead><tbody id="expensesTableBody"><tr><td colspan="8" style="text-align: center; padding: 40px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr></tbody></table></div>
            </div>
        </div>
    </div>
    <div id="modalsContainer"></div>
    <script>
        const SUPABASE_URL='https://sstvsknmmhbwubzajeix.supabase.co';
        const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdHZza25tbWhid3ViemFqZWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNDM0NjIsImV4cCI6MjA3NDkxOTQ2Mn0.EeVUU9DxRYUi38nUHgWEsnG8li7KZjqAGPNW9IDokhg';
        const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
        let currentUser=null,currentProjectId=null,currentProject=null,allAnimals=[],inventoryItems=[],feedMaterialCounter=0;
        
        window.addEventListener('DOMContentLoaded',async()=>{
            await checkAuth();
            await loadProject();
            await loadStats();
            await loadAnimals();
            createAllModals();
            setDefaultDate();
            hideLoading();
        });
        
        function hideLoading(){document.getElementById('loading').style.display='none';}
        
        async function checkAuth(){
            const{data:{user},error}=await supabase.auth.getUser();
            if(error||!user){window.location.href='login.html';return;}
            currentUser=user;
        }
        
        async function loadProject(){
            const urlParams=new URLSearchParams(window.location.search);
            currentProjectId=urlParams.get('id');
            if(!currentProjectId){showError('ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');return;}
            try{
                const{data,error}=await supabase.from('projects').select('*').eq('id',currentProjectId).single();
                if(error)throw error;
                currentProject=data;
                document.getElementById('projectName').textContent=data.name;
                const statusBadge=document.getElementById('projectStatus');
                const toggleBtn=document.getElementById('toggleStatusBtn');
                if(data.status==='active'){
                    statusBadge.textContent='ŸÜÿ¥ÿ∑';
                    statusBadge.className='project-status status-active';
                    toggleBtn.innerHTML='‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ';
                }else{
                    statusBadge.textContent='ŸÖÿ™ŸàŸÇŸÅ';
                    statusBadge.className='project-status status-inactive';
                    toggleBtn.innerHTML='‚ñ∂Ô∏è ÿ™ŸÅÿπŸäŸÑ';
                }
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');
            }
        }
        
        async function loadStats(){
            try{
                const{data:animals,error}=await supabase.from('animals').select('*').eq('project_id',currentProjectId).eq('status','alive');
                if(error)throw error;
                
                const today=new Date();
                
                let lambs=0;
                let ewes=0;
                let rams=0;
                
                animals.forEach(animal=>{
                    if(animal.birth_date){
                        const birthDate=new Date(animal.birth_date);
                        const ageInDays=Math.floor((today-birthDate)/(1000*60*60*24));
                        const isLamb=ageInDays<365;
                        
                        if(isLamb){
                            lambs++;
                        }else{
                            if(animal.sex==='female'){ewes++;}
                            else if(animal.sex==='male'){rams++;}
                        }
                    }else{
                        if(animal.sex==='female'){ewes++;}
                        else if(animal.sex==='male'){rams++;}
                    }
                });
                
                const total=animals.length;
                console.log('Stats:',{total:total,ewes:ewes,rams:rams,lambs:lambs});
                
                document.getElementById('ewesCount').textContent=ewes;
                document.getElementById('ramsCount').textContent=rams;
                document.getElementById('lambsCount').textContent=lambs;
                document.getElementById('totalCount').textContent=total;
            }catch(error){
                console.error('Error loading stats:',error);
            }
        }
        
        function showTab(tabName){
            const tabs=document.querySelectorAll('.tab-pane');
            tabs.forEach(tab=>tab.classList.remove('active'));
            const buttons=document.querySelectorAll('.tab-button');
            buttons.forEach(btn=>btn.classList.remove('active'));
            document.getElementById(tabName+'Tab').classList.add('active');
            event.target.classList.add('active');
            
            switch(tabName){
                case'animals':loadAnimals();break;
                case'health':loadHealthRecords();break;
                case'births':loadBirths();break;
                case'feeding':loadFeedings();break;
                case'sales':loadSales();break;
                case'loans':loadLoans();break;
                case'expenses':loadExpenses();break;
            }
        }
        
        async function loadAnimals(){
            const tbody=document.getElementById('animalsTableBody');
            tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                let query=supabase.from('animals').select('*').eq('project_id',currentProjectId).order('created_at',{ascending:false});
                const filterStatus=document.getElementById('filterStatus').value;
                const filterSex=document.getElementById('filterSex').value;
                if(filterStatus)query=query.eq('status',filterStatus);
                if(filterSex)query=query.eq('sex',filterSex);
                const{data,error}=await query;
                if(error)throw error;
                allAnimals=data||[];
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ŸäŸàÿßŸÜÿßÿ™</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(animal=>`<tr><td>${animal.tag_number}</td><td>${translateSpecies(animal.species)}</td><td>${translateSex(animal.sex)}</td><td>${animal.birth_date?formatDate(animal.birth_date):'-'}</td><td>${animal.birth_date?calculateAge(animal.birth_date):'-'}</td><td>${animal.weight_kg||'-'}</td><td><span class="badge badge-${getStatusColor(animal.status)}">${translateStatus(animal.status)}</span></td><td><span class="badge badge-${getHealthColor(animal.health_status)}">${translateHealthStatus(animal.health_status)}</span></td><td><button class="btn btn-warning btn-sm" onclick='editAnimal(${JSON.stringify(animal).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteAnimal('${animal.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="9" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadHealthRecords(){
            const tbody=document.getElementById('healthTableBody');
            tbody.innerHTML='<tr><td colspan="8" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                const{data,error}=await supabase.from('health_records').select('*, animals(tag_number)').eq('user_id',currentUser.id).order('date',{ascending:false});
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="8" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿµÿ≠Ÿäÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(record=>`<tr><td>${formatDate(record.date)}</td><td>${record.animals?.tag_number||'-'}</td><td>${translateRecordType(record.record_type)}</td><td>${record.vaccine_name||record.disease_name||'-'}</td><td>${record.veterinarian_name||'-'}</td><td>${record.cost?record.cost+' ÿØÿ¨':'-'}</td><td>${record.next_date?formatDate(record.next_date):'-'}</td><td><button class="btn btn-warning btn-sm" onclick='editHealthRecord(${JSON.stringify(record).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteHealthRecord('${record.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="8" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadBirths(){
            const tbody=document.getElementById('birthsTableBody');
            tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                const{data,error}=await supabase.from('births').select('*, mother:mother_id(tag_number), father:father_id(tag_number)').eq('project_id',currentProjectId).order('actual_birth_date',{ascending:false});
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸàŸÑÿßÿØÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(birth=>`<tr><td>${birth.actual_birth_date?formatDate(birth.actual_birth_date):'-'}</td><td>${birth.mother?.tag_number||'-'}</td><td>${birth.father?.tag_number||'-'}</td><td>${birth.total_born||0}</td><td>${birth.alive_count||0}</td><td>${birth.dead_count||0}</td><td>${birth.average_birth_weight?birth.average_birth_weight+' ŸÉÿ¨ŸÖ':'-'}</td><td>${birth.notes||'-'}</td><td><button class="btn btn-warning btn-sm" onclick='editBirth(${JSON.stringify(birth).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteBirth('${birth.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="9" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadFeedings(){
            const tbody=document.getElementById('feedingTableBody');
            tbody.innerHTML='<tr><td colspan="7" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                const{data,error}=await supabase.from('feed_log').select('*').eq('project_id',currentProjectId).order('feed_date',{ascending:false});
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="7" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿ™ÿ∫ÿ∞Ÿäÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(feed=>`<tr><td>${formatDate(feed.feed_date)}</td><td>${feed.animals_count||'-'}</td><td>${formatFeedItems(feed.feed_items)}</td><td>${feed.total_cost?feed.total_cost+' ÿØÿ¨':'-'}</td><td>${feed.fed_by||'-'}</td><td>${feed.notes||'-'}</td><td><button class="btn btn-warning btn-sm" onclick='editFeeding(${JSON.stringify(feed).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteFeeding('${feed.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="7" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadSales(){
            const tbody=document.getElementById('salesTableBody');
            tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                const{data,error}=await supabase.from('sales').select('*').eq('project_id',currentProjectId).order('sale_date',{ascending:false});
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ®Ÿäÿπÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(sale=>`<tr><td>${formatDate(sale.sale_date)}</td><td>${translateItemType(sale.item_type)}</td><td>${sale.item_description||'-'}</td><td>${sale.quantity} ${translateUnit(sale.unit)}</td><td>${sale.total_amount} ÿØÿ¨</td><td>${sale.buyer_name||'-'}</td><td><span class="badge badge-${getPaymentStatusColor(sale.payment_status)}">${translatePaymentStatus(sale.payment_status)}</span></td><td>${sale.amount_remaining?sale.amount_remaining+' ÿØÿ¨':'-'}</td><td><button class="btn btn-warning btn-sm" onclick='editSale(${JSON.stringify(sale).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteSale('${sale.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="9" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadLoans(){
            const tbody=document.getElementById('loansTableBody');
            tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                const{data,error}=await supabase.from('sheep_loans').select('*, animals(tag_number)').eq('project_id',currentProjectId).order('loan_date',{ascending:false});
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="9" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇÿ±Ÿàÿ∂ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(loan=>{
                    const remaining=loan.loan_amount-(loan.amount_paid||0);
                    const status=remaining<=0?'paid':(loan.amount_paid>0?'partial':'pending');
                    return`<tr><td>${formatDate(loan.loan_date)}</td><td>${loan.borrower_name}</td><td>${loan.borrower_phone}</td><td>${loan.animals?.tag_number||'-'}</td><td>${loan.loan_amount} ÿØÿ¨</td><td>${loan.amount_paid||0} ÿØÿ¨</td><td>${remaining.toFixed(2)} ÿØÿ¨</td><td><span class="badge badge-${getPaymentStatusColor(status)}">${translatePaymentStatus(status)}</span></td><td>${remaining>0?`<button class="btn btn-success btn-sm" onclick="recordLoanPayment('${loan.id}',${remaining})">üí∞ ÿØŸÅÿπÿ©</button>`:''} <button class="btn btn-danger btn-sm" onclick="deleteLoan('${loan.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`;
                }).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="9" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        async function loadExpenses(){
            const tbody=document.getElementById('expensesTableBody');
            tbody.innerHTML='<tr><td colspan="8" style="text-align: center;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>';
            try{
                let query=supabase.from('expenses').select('*').eq('project_id',currentProjectId).order('expense_date',{ascending:false});
                const filterCategory=document.getElementById('filterExpenseCategory').value;
                if(filterCategory)query=query.eq('category',filterCategory);
                const{data,error}=await query;
                if(error)throw error;
                if(data.length===0){
                    tbody.innerHTML='<tr><td colspan="8" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿµÿßÿ±ŸäŸÅ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                    return;
                }
                tbody.innerHTML=data.map(expense=>`<tr><td>${formatDate(expense.expense_date)}</td><td>${translateExpenseCategory(expense.category)}</td><td>${expense.description}</td><td>${expense.amount} ÿØÿ¨</td><td>${expense.paid_to||'-'}</td><td>${translatePaymentMethod(expense.payment_method)}</td><td>${expense.notes||'-'}</td><td><button class="btn btn-warning btn-sm" onclick='editExpense(${JSON.stringify(expense).replace(/'/g,"&apos;")})'>‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button> <button class="btn btn-danger btn-sm" onclick="deleteExpense('${expense.id}')">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button></td></tr>`).join('');
            }catch(error){
                console.error('Error:',error);
                tbody.innerHTML='<tr><td colspan="8" style="text-align: center; color: red;">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</td></tr>';
            }
        }
        
        function createAllModals(){
            document.getElementById('modalsContainer').innerHTML=`${createAnimalModal()}${createHealthModal()}${createBirthModal()}${createFeedingModal()}${createSaleModal()}${createLoanModal()}${createExpenseModal()}`;
        }
        
        function createAnimalModal(){
            return`<div id="animalModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 id="animalModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸäŸàÿßŸÜ ÿ¨ÿØŸäÿØ</h3><button class="modal-close" onclick="closeModal('animalModal')">&times;</button></div><div class="modal-body"><form id="animalForm"><input type="hidden" id="animalId"><div class="form-row"><div class="form-group"><label class="form-label">ÿ±ŸÇŸÖ ÿßŸÑÿπŸÑÿßŸÖÿ© *</label><input type="text" class="form-control" id="animalTag" required></div><div class="form-group"><label class="form-label">ÿßŸÑŸÜŸàÿπ *</label><select class="form-control" id="animalSpecies" required><option value="sheep">ÿ∫ŸÜŸÖ</option><option value="goat">ŸÖÿßÿπÿ≤</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ¨ŸÜÿ≥ *</label><select class="form-control" id="animalSex" required><option value="male">ÿ∞ŸÉÿ±</option><option value="female">ÿ£ŸÜÿ´Ÿâ</option></select></div><div class="form-group"><label class="form-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ</label><input type="date" class="form-control" id="animalBirthDate"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑŸàÿ≤ŸÜ (ŸÉÿ¨ŸÖ)</label><input type="number" step="0.1" class="form-control" id="animalWeight"></div><div class="form-group"><label class="form-label">ÿßŸÑÿ≥ŸÑÿßŸÑÿ©</label><input type="text" class="form-control" id="animalBreed"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑŸÑŸàŸÜ</label><input type="text" class="form-control" id="animalColor"></div><div class="form-group"><label class="form-label">ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿµÿ≠Ÿäÿ©</label><select class="form-control" id="animalHealthStatus"><option value="healthy">ÿ≥ŸÑŸäŸÖ</option><option value="sick">ŸÖÿ±Ÿäÿ∂</option><option value="quarantine">ÿ≠ÿ¨ÿ± ÿµÿ≠Ÿä</option><option value="treatment">ÿ™ÿ≠ÿ™ ÿßŸÑÿπŸÑÿßÿ¨</option></select></div></div><div class="form-group"><label class="form-label">ÿπŸÑÿßŸÖÿßÿ™ ŸÖŸÖŸäÿ≤ÿ©</label><textarea class="form-control" id="animalMarks"></textarea></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="animalNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('animalModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveAnimal()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createHealthModal(){
            return`<div id="healthModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑ ÿµÿ≠Ÿä</h3><button class="modal-close" onclick="closeModal('healthModal')">&times;</button></div><div class="modal-body"><form id="healthForm"><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ≠ŸäŸàÿßŸÜ *</label><select class="form-control" id="healthAnimal" required><option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ≠ŸäŸàÿßŸÜ</option></select></div><div class="form-group"><label class="form-label">ŸÜŸàÿπ ÿßŸÑÿ≥ÿ¨ŸÑ *</label><select class="form-control" id="healthRecordType" required><option value="vaccination">ÿ™ÿ∑ÿπŸäŸÖ</option><option value="treatment">ÿπŸÑÿßÿ¨</option><option value="checkup">ŸÅÿ≠ÿµ</option><option value="disease">ŸÖÿ±ÿ∂</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ *</label><input type="date" class="form-control" id="healthDate" required></div><div class="form-group"><label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÑŸÇÿßÿ≠/ÿßŸÑŸÖÿ±ÿ∂</label><input type="text" class="form-control" id="healthName"></div></div><div class="form-group"><label class="form-label">ÿßŸÑÿπŸÑÿßÿ¨/ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</label><textarea class="form-control" id="healthTreatment"></textarea></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ∑ÿ®Ÿäÿ® ÿßŸÑÿ®Ÿäÿ∑ÿ±Ÿä</label><input type="text" class="form-control" id="healthVet"></div><div class="form-group"><label class="form-label">Ÿáÿßÿ™ŸÅ ÿßŸÑÿ∑ÿ®Ÿäÿ®</label><input type="tel" class="form-control" id="healthVetPhone"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</label><input type="number" step="0.01" class="form-control" id="healthCost"></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖŸàÿπÿØ ÿßŸÑÿ™ÿßŸÑŸä</label><input type="date" class="form-control" id="healthNextDate"></div></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="healthNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('healthModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveHealthRecord()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createBirthModal(){
            return`<div id="birthModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ™ÿ≥ÿ¨ŸäŸÑ ŸàŸÑÿßÿØÿ©</h3><button class="modal-close" onclick="closeModal('birthModal')">&times;</button></div><div class="modal-body"><form id="birthForm"><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ£ŸÖ *</label><select class="form-control" id="birthMother" required><option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ£ŸÖ</option></select></div><div class="form-group"><label class="form-label">ÿßŸÑÿ£ÿ®</label><select class="form-control" id="birthFather"><option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ£ÿ®</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ŸÑŸÇŸäÿ≠</label><input type="date" class="form-control" id="birthMatingDate"></div><div class="form-group"><label class="form-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸàŸÑÿßÿØÿ© ÿßŸÑŸÖÿ™ŸàŸÇÿπ</label><input type="date" class="form-control" id="birthExpectedDate"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸàŸÑÿßÿØÿ© ÿßŸÑŸÅÿπŸÑŸä *</label><input type="date" class="form-control" id="birthActualDate" required></div><div class="form-group"><label class="form-label">ŸÖÿ™Ÿàÿ≥ÿ∑ Ÿàÿ≤ŸÜ ÿßŸÑŸÖŸàÿßŸÑŸäÿØ (ŸÉÿ¨ŸÖ)</label><input type="number" step="0.1" class="form-control" id="birthAvgWeight"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸàÿßŸÑŸäÿØ *</label><input type="number" class="form-control" id="birthTotal" required min="0"></div><div class="form-group"><label class="form-label">ÿßŸÑÿ£ÿ≠Ÿäÿßÿ° *</label><input type="number" class="form-control" id="birthAlive" required min="0"></div></div><div class="form-group"><label class="form-label">ÿßŸÑŸàŸÅŸäÿßÿ™</label><input type="number" class="form-control" id="birthDead" value="0" min="0"></div><div class="form-group"><label class="form-label">ŸÖÿ∂ÿßÿπŸÅÿßÿ™</label><textarea class="form-control" id="birthComplications"></textarea></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="birthNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('birthModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveBirth()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createFeedingModal(){
            return`<div id="feedingModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ÿ∫ÿ∞Ÿäÿ©</h3><button class="modal-close" onclick="closeModal('feedingModal')">&times;</button></div><div class="modal-body"><form id="feedingForm"><div class="info-box"><p><strong>ŸÖŸÑÿßÿ≠ÿ∏ÿ©:</strong> ÿ≥Ÿäÿ™ŸÖ ÿÆÿµŸÖ ÿßŸÑŸÉŸÖŸäÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</p></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ *</label><input type="date" class="form-control" id="feedDate" required></div><div class="form-group"><label class="form-label">ÿπÿØÿØ ÿßŸÑÿ±ÿ§Ÿàÿ≥</label><input type="number" class="form-control" id="feedAnimalsCount" min="0"></div></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©</label><input type="text" class="form-control" id="feedFedBy"></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ©</label><button type="button" class="btn btn-success btn-sm" onclick="addFeedMaterial()" style="margin-bottom: 10px;">‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿßÿØÿ©</button><div id="feedMaterialsContainer"></div></div><div class="form-group"><label class="form-label">ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©</label><input type="number" step="0.01" class="form-control" id="feedTotalCost" readonly></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="feedNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('feedingModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveFeeding()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createSaleModal(){
            return`<div id="saleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®Ÿäÿπ</h3><button class="modal-close" onclick="closeModal('saleModal')">&times;</button></div><div class="modal-body"><form id="saleForm"><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ *</label><input type="date" class="form-control" id="saleDate" required></div><div class="form-group"><label class="form-label">ŸÜŸàÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ *</label><select class="form-control" id="saleItemType" required><option value="live_animal">ÿ≠ŸäŸàÿßŸÜ ÿ≠Ÿä</option><option value="meat">ŸÑÿ≠ŸàŸÖ</option><option value="wool">ÿµŸàŸÅ</option><option value="milk">ÿ≠ŸÑŸäÿ®</option><option value="other">ÿ£ÿÆÿ±Ÿâ</option></select></div></div><div class="form-group"><label class="form-label">ŸàÿµŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨</label><input type="text" class="form-control" id="saleDescription"></div><div class="form-group"><label class="form-label">ÿßŸÑÿ≠ŸäŸàÿßŸÜ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label><select class="form-control" id="saleAnimal"><option value="">ŸÑÿß ŸäŸàÿ¨ÿØ</option></select></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑŸÉŸÖŸäÿ© *</label><input type="number" step="0.01" class="form-control" id="saleQuantity" required oninput="calculateSaleTotal()"></div><div class="form-group"><label class="form-label">ÿßŸÑŸàÿ≠ÿØÿ© *</label><select class="form-control" id="saleUnit" required><option value="head">ÿ±ÿ£ÿ≥</option><option value="kg">ŸÉÿ¨ŸÖ</option><option value="liter">ŸÑÿ™ÿ±</option><option value="piece">ŸÇÿ∑ÿπÿ©</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©</label><input type="number" step="0.01" class="form-control" id="saleUnitPrice" oninput="calculateSaleTotal()"></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä *</label><input type="number" step="0.01" class="form-control" id="saleTotalAmount" required></div></div><div class="info-box"><p><strong>ŸÖŸÑÿßÿ≠ÿ∏ÿ©:</strong> ŸäŸÖŸÉŸÜŸÉ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿ£Ÿà ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ© ŸÑÿ≠ÿ≥ÿßÿ®Ÿá ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã</p></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä</label><input type="text" class="form-control" id="saleBuyerName"></div><div class="form-group"><label class="form-label">Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä</label><input type="tel" class="form-control" id="saleBuyerPhone"></div></div><div class="form-group"><label class="form-label">ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä</label><input type="text" class="form-control" id="saleBuyerAddress"></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ</label><select class="form-control" id="salePaymentMethod"><option value="cash">ŸÜŸÇÿØŸä</option><option value="bank_transfer">ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä</option><option value="check">ÿ¥ŸäŸÉ</option><option value="installment">ÿ™ŸÇÿ≥Ÿäÿ∑</option></select></div><div class="form-group"><label class="form-label">ÿ≠ÿßŸÑÿ© ÿßŸÑÿØŸÅÿπ *</label><select class="form-control" id="salePaymentStatus" required onchange="toggleSalePaymentFields()"><option value="paid">ŸÖÿØŸÅŸàÿπ</option><option value="partial">ÿØŸÅÿπ ÿ¨ÿ≤ÿ¶Ÿä</option><option value="pending">ŸÖÿπŸÑŸÇ</option></select></div></div><div class="form-row" id="salePaymentDetailsRow" style="display: none;"><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ</label><input type="number" step="0.01" class="form-control" id="saleAmountPaid" oninput="calculateSaleRemaining()"></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</label><input type="number" step="0.01" class="form-control" id="saleAmountRemaining" readonly></div></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="saleNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('saleModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveSale()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createLoanModal(){
            return`<div id="loanModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ±ÿ∂ ÿπŸäÿØ</h3><button class="modal-close" onclick="closeModal('loanModal')">&times;</button></div><div class="modal-body"><form id="loanForm"><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ *</label><input type="date" class="form-control" id="loanDate" required></div><div class="form-group"><label class="form-label">ÿßŸÑÿ≠ŸäŸàÿßŸÜ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label><select class="form-control" id="loanAnimal"><option value="">ŸÑÿß ŸäŸàÿ¨ÿØ</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÇÿ™ÿ±ÿ∂ *</label><input type="text" class="form-control" id="loanBorrowerName" required></div><div class="form-group"><label class="form-label">Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖŸÇÿ™ÿ±ÿ∂ *</label><input type="tel" class="form-control" id="loanBorrowerPhone" required></div></div><div class="form-group"><label class="form-label">ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸÇÿ™ÿ±ÿ∂</label><input type="text" class="form-control" id="loanBorrowerAddress"></div><div class="form-row"><div class="form-group"><label class="form-label">ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿ±ÿ∂ *</label><input type="number" step="0.01" class="form-control" id="loanAmount" required></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ</label><input type="number" step="0.01" class="form-control" id="loanAmountPaid" value="0"></div></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="loanNotes"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('loanModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button class="btn btn-primary" onclick="saveLoan()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function createExpenseModal(){
            return`<div id="expenseModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ</h3><button class="modal-close" onclick="closeModal('expenseModal')">&times;</button></div><div class="modal-body"><form id="expenseForm" onsubmit="event.preventDefault(); saveExpense();"><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ *</label><input type="date" class="form-control" id="expenseDate" required></div><div class="form-group"><label class="form-label">ÿßŸÑŸÅÿ¶ÿ© *</label><select class="form-control" id="expenseCategory" required><option value="feeding">ÿ™ÿ∫ÿ∞Ÿäÿ©</option><option value="health">ÿµÿ≠ÿ©</option><option value="labor">ÿ£ÿ¨Ÿàÿ± ÿπŸÖÿßŸÑ</option><option value="cleaning">ÿ™ŸÜÿ∏ŸäŸÅ</option><option value="sterilization">ÿ™ÿπŸÇŸäŸÖ</option><option value="maintenance">ÿµŸäÿßŸÜÿ©</option><option value="other">ÿ£ÿÆÿ±Ÿâ</option></select></div></div><div class="form-group"><label class="form-label">ÿßŸÑŸàÿµŸÅ *</label><input type="text" class="form-control" id="expenseDescription" required placeholder="ŸÖÿ´ÿßŸÑ: ÿ¥ÿ±ÿßÿ° ÿπŸÑŸÅÿå ÿØŸÅÿπ ÿ£ÿ¨Ÿàÿ± ÿπÿßŸÖŸÑ..."></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ *</label><input type="number" step="0.01" class="form-control" id="expenseAmount" required min="0.01" placeholder="0.00"></div><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿ≥ÿ™ŸÅŸäÿØ</label><input type="text" class="form-control" id="expensePaidTo" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÅŸäÿØ"></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ</label><select class="form-control" id="expensePaymentMethod"><option value="cash">ŸÜŸÇÿØŸä</option><option value="bank_transfer">ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä</option><option value="check">ÿ¥ŸäŸÉ</option></select></div><div class="form-group"><label class="form-label">ÿ±ŸÇŸÖ ÿßŸÑÿ•ŸäÿµÿßŸÑ</label><input type="text" class="form-control" id="expenseReceiptNumber" placeholder="ÿ±ŸÇŸÖ ÿßŸÑÿ•ŸäÿµÿßŸÑ ÿ£Ÿà ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©"></div></div><div class="form-group"><label class="form-label">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label><textarea class="form-control" id="expenseNotes" placeholder="ÿ£Ÿä ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©..."></textarea></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">ÿ•ŸÑÿ∫ÿßÿ°</button><button type="button" class="btn btn-primary" onclick="saveExpense()">ÿ≠ŸÅÿ∏</button></div></div></div>`;
        }
        
        function openAddAnimalModal(){
            document.getElementById('animalModalTitle').textContent='ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸäŸàÿßŸÜ ÿ¨ÿØŸäÿØ';
            document.getElementById('animalForm').reset();
            document.getElementById('animalId').value='';
            document.getElementById('animalModal').classList.add('show');
        }
        
        function editAnimal(animal){
            document.getElementById('animalModalTitle').textContent='ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ŸäŸàÿßŸÜ';
            document.getElementById('animalId').value=animal.id;
            document.getElementById('animalTag').value=animal.tag_number;
            document.getElementById('animalSpecies').value=animal.species;
            document.getElementById('animalSex').value=animal.sex;
            document.getElementById('animalBirthDate').value=animal.birth_date||'';
            document.getElementById('animalWeight').value=animal.weight_kg||'';
            document.getElementById('animalBreed').value=animal.breed||'';
            document.getElementById('animalColor').value=animal.color||'';
            document.getElementById('animalHealthStatus').value=animal.health_status;
            document.getElementById('animalMarks').value=animal.special_marks||'';
            document.getElementById('animalNotes').value=animal.notes||'';
            document.getElementById('animalModal').classList.add('show');
        }
        
        async function openAddHealthRecordModal(){
            await loadAnimalsForSelect('healthAnimal');
            document.getElementById('healthForm').reset();
            document.getElementById('healthForm').removeAttribute('data-edit-id');
            document.getElementById('healthModal').classList.add('show');
        }
        
        function editHealthRecord(record){
            document.getElementById('healthAnimal').value=record.animal_id;
            document.getElementById('healthRecordType').value=record.record_type;
            document.getElementById('healthDate').value=record.date;
            document.getElementById('healthName').value=record.vaccine_name||record.disease_name||'';
            document.getElementById('healthTreatment').value=record.treatment||'';
            document.getElementById('healthVet').value=record.veterinarian_name||'';
            document.getElementById('healthVetPhone').value=record.veterinarian_phone||'';
            document.getElementById('healthCost').value=record.cost||'';
            document.getElementById('healthNextDate').value=record.next_date||'';
            document.getElementById('healthNotes').value=record.notes||'';
            document.getElementById('healthForm').setAttribute('data-edit-id',record.id);
            document.getElementById('healthModal').classList.add('show');
        }
        
        async function openAddBirthModal(){
            await loadAnimalsForSelect('birthMother','female');
            await loadAnimalsForSelect('birthFather','male');
            document.getElementById('birthForm').reset();
            document.getElementById('birthForm').removeAttribute('data-edit-id');
            document.getElementById('birthModal').classList.add('show');
        }
        
        async function editBirth(birth){
            await loadAnimalsForSelect('birthMother','female');
            await loadAnimalsForSelect('birthFather','male');
            document.getElementById('birthMother').value=birth.mother_id;
            document.getElementById('birthFather').value=birth.father_id||'';
            document.getElementById('birthMatingDate').value=birth.mating_date||'';
            document.getElementById('birthExpectedDate').value=birth.expected_birth_date||'';
            document.getElementById('birthActualDate').value=birth.actual_birth_date;
            document.getElementById('birthTotal').value=birth.total_born;
            document.getElementById('birthAlive').value=birth.alive_count;
            document.getElementById('birthDead').value=birth.dead_count;
            document.getElementById('birthAvgWeight').value=birth.average_birth_weight||'';
            document.getElementById('birthComplications').value=birth.complications||'';
            document.getElementById('birthNotes').value=birth.notes||'';
            document.getElementById('birthForm').setAttribute('data-edit-id',birth.id);
            document.getElementById('birthModal').classList.add('show');
        }
        
        async function openAddFeedingModal(){
            await loadInventory();
            document.getElementById('feedingForm').reset();
            document.getElementById('feedingForm').removeAttribute('data-edit-id');
            document.getElementById('feedMaterialsContainer').innerHTML='';
            feedMaterialCounter=0;
            addFeedMaterial();
            document.getElementById('feedingModal').classList.add('show');
        }
        
        async function editFeeding(feed){
            await loadInventory();
            document.getElementById('feedDate').value=feed.feed_date;
            document.getElementById('feedAnimalsCount').value=feed.animals_count||'';
            document.getElementById('feedFedBy').value=feed.fed_by||'';
            document.getElementById('feedNotes').value=feed.notes||'';
            document.getElementById('feedMaterialsContainer').innerHTML='';
            feedMaterialCounter=0;
            const feedItems=typeof feed.feed_items==='string'?JSON.parse(feed.feed_items):feed.feed_items;
            feedItems.forEach(item=>{
                addFeedMaterial();
                const id=feedMaterialCounter;
                const select=document.querySelector(`.feed-material-select[data-id="${id}"]`);
                const matchingInventory=inventoryItems.find(inv=>inv.item_name===item.item_name);
                if(matchingInventory){
                    select.value=matchingInventory.id;
                    updateMaterialInfo(id);
                }
                const quantityInput=document.querySelector(`.feed-quantity[data-id="${id}"]`);
                quantityInput.value=item.quantity;
                const priceInput=document.querySelector(`.feed-unit-price[data-id="${id}"]`);
                priceInput.value=item.unit_price||0;
                calculateFeedCost();
            });
            document.getElementById('feedingForm').setAttribute('data-edit-id',feed.id);
            document.getElementById('feedingModal').classList.add('show');
        }
        
        async function openAddSaleModal(){
            await loadAnimalsForSelect('saleAnimal');
            document.getElementById('saleForm').reset();
            document.getElementById('saleForm').removeAttribute('data-edit-id');
            document.getElementById('salePaymentDetailsRow').style.display='none';
            document.getElementById('saleModal').classList.add('show');
        }
        
        async function editSale(sale){
            await loadAnimalsForSelect('saleAnimal');
            document.getElementById('saleDate').value=sale.sale_date;
            document.getElementById('saleItemType').value=sale.item_type;
            document.getElementById('saleDescription').value=sale.item_description||'';
            document.getElementById('saleAnimal').value=sale.animal_id||'';
            document.getElementById('saleQuantity').value=sale.quantity;
            document.getElementById('saleUnit').value=sale.unit;
            document.getElementById('saleUnitPrice').value=sale.unit_price||'';
            document.getElementById('saleTotalAmount').value=sale.total_amount;
            document.getElementById('saleBuyerName').value=sale.buyer_name||'';
            document.getElementById('saleBuyerPhone').value=sale.buyer_phone||'';
            document.getElementById('saleBuyerAddress').value=sale.buyer_address||'';
            document.getElementById('salePaymentMethod').value=sale.payment_method||'cash';
            document.getElementById('salePaymentStatus').value=sale.payment_status;
            document.getElementById('saleAmountPaid').value=sale.amount_paid||'';
            document.getElementById('saleAmountRemaining').value=sale.amount_remaining||'';
            document.getElementById('saleNotes').value=sale.notes||'';
            toggleSalePaymentFields();
            document.getElementById('saleForm').setAttribute('data-edit-id',sale.id);
            document.getElementById('saleModal').classList.add('show');
        }
        
        async function openAddLoanModal(){
            await loadAnimalsForSelect('loanAnimal');
            document.getElementById('loanForm').reset();
            document.getElementById('loanModal').classList.add('show');
        }
        
        function openAddExpenseModal(){
            document.getElementById('expenseForm').reset();
            document.getElementById('expenseForm').removeAttribute('data-edit-id');
            document.getElementById('expenseModal').classList.add('show');
        }
        
        function editExpense(expense){
            document.getElementById('expenseDate').value=expense.expense_date;
            document.getElementById('expenseCategory').value=expense.category;
            document.getElementById('expenseDescription').value=expense.description;
            document.getElementById('expenseAmount').value=expense.amount;
            document.getElementById('expensePaidTo').value=expense.paid_to||'';
            document.getElementById('expensePaymentMethod').value=expense.payment_method||'cash';
            document.getElementById('expenseReceiptNumber').value=expense.receipt_number||'';
            document.getElementById('expenseNotes').value=expense.notes||'';
            document.getElementById('expenseForm').setAttribute('data-edit-id',expense.id);
            document.getElementById('expenseModal').classList.add('show');
        }
        
        function closeModal(modalId){
            document.getElementById(modalId).classList.remove('show');
        }
        
        async function loadAnimalsForSelect(selectId,sex=null){
            const select=document.getElementById(selectId);
            if(!select)return;
            select.innerHTML='<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ≠ŸäŸàÿßŸÜ</option>';
            try{
                let query=supabase.from('animals').select('*').eq('project_id',currentProjectId).eq('status','alive');
                if(sex)query=query.eq('sex',sex);
                const{data,error}=await query;
                if(error)throw error;
                data.forEach(animal=>{
                    const option=document.createElement('option');
                    option.value=animal.id;
                    option.textContent=`${animal.tag_number} - ${translateSpecies(animal.species)} ${translateSex(animal.sex)}`;
                    select.appendChild(option);
                });
            }catch(error){
                console.error('Error:',error);
            }
        }
        
        async function loadInventory(){
            try{
                const{data,error}=await supabase.from('inventory').select('*').eq('user_id',currentUser.id).gt('quantity',0).order('item_name');
                if(error)throw error;
                inventoryItems=data||[];
            }catch(error){
                console.error('Error:',error);
                inventoryItems=[];
            }
        }
        
        function addFeedMaterial(){
            feedMaterialCounter++;
            const container=document.getElementById('feedMaterialsContainer');
            const materialDiv=document.createElement('div');
            materialDiv.className='material-item';
            materialDiv.id=`material-${feedMaterialCounter}`;
            materialDiv.innerHTML=`<div class="material-item-header"><strong>ŸÖÿßÿØÿ© #${feedMaterialCounter}</strong><button type="button" class="btn btn-danger btn-sm" onclick="removeFeedMaterial(${feedMaterialCounter})">ÿ≠ÿ∞ŸÅ</button></div><div class="form-row"><div class="form-group"><label class="form-label">ÿßŸÑŸÖÿßÿØÿ© *</label><select class="form-control feed-material-select" data-id="${feedMaterialCounter}" onchange="updateMaterialInfo(${feedMaterialCounter})" required><option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿßÿØÿ©</option>${inventoryItems.map(item=>`<option value="${item.id}" data-available="${item.quantity}" data-unit="${item.unit}" data-price="${item.unit_price||0}">${item.item_name} (ŸÖÿ™ŸàŸÅÿ±: ${item.quantity} ${item.unit})</option>`).join('')}</select></div><div class="form-group"><label class="form-label">ÿßŸÑŸÉŸÖŸäÿ© *</label><input type="number" step="0.01" class="form-control feed-quantity" data-id="${feedMaterialCounter}" oninput="calculateFeedCost()" required><small class="form-text text-muted" id="unit-${feedMaterialCounter}"></small></div></div><div class="form-row"><div class="form-group"><label class="form-label">ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©</label><input type="number" step="0.01" class="form-control feed-unit-price" data-id="${feedMaterialCounter}" oninput="calculateFeedCost()" readonly></div><div class="form-group"><label class="form-label">ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</label><input type="number" step="0.01" class="form-control feed-item-cost" data-id="${feedMaterialCounter}" readonly></div></div>`;
            container.appendChild(materialDiv);
        }
        
        function removeFeedMaterial(id){
            const element=document.getElementById(`material-${id}`);
            if(element){
                element.remove();
                calculateFeedCost();
            }
        }
        
        function updateMaterialInfo(id){
            const select=document.querySelector(`.feed-material-select[data-id="${id}"]`);
            if(!select)return;
            const selectedOption=select.options[select.selectedIndex];
            if(selectedOption.value){
                const unit=selectedOption.dataset.unit;
                const price=selectedOption.dataset.price;
                const unitDisplay=document.getElementById(`unit-${id}`);
                if(unitDisplay)unitDisplay.textContent=`ÿßŸÑŸàÿ≠ÿØÿ©: ${unit}`;
                const priceInput=document.querySelector(`.feed-unit-price[data-id="${id}"]`);
                if(priceInput)priceInput.value=price;
            }else{
                const unitDisplay=document.getElementById(`unit-${id}`);
                if(unitDisplay)unitDisplay.textContent='';
                const priceInput=document.querySelector(`.feed-unit-price[data-id="${id}"]`);
                if(priceInput)priceInput.value='';
            }
            calculateFeedCost();
        }
        
        function calculateFeedCost(){
            let totalCost=0;
            document.querySelectorAll('.feed-material-select').forEach(select=>{
                if(select.value){
                    const id=select.dataset.id;
                    const quantityInput=document.querySelector(`.feed-quantity[data-id="${id}"]`);
                    const unitPriceInput=document.querySelector(`.feed-unit-price[data-id="${id}"]`);
                    const itemCostInput=document.querySelector(`.feed-item-cost[data-id="${id}"]`);
                    const quantity=parseFloat(quantityInput?.value||0);
                    const unitPrice=parseFloat(unitPriceInput?.value||0);
                    const itemCost=quantity*unitPrice;
                    if(itemCostInput)itemCostInput.value=itemCost.toFixed(2);
                    totalCost+=itemCost;
                }
            });
            const totalCostInput=document.getElementById('feedTotalCost');
            if(totalCostInput)totalCostInput.value=totalCost.toFixed(2);
        }
        
        function calculateSaleTotal(){
            const quantity=parseFloat(document.getElementById('saleQuantity').value)||0;
            const unitPrice=parseFloat(document.getElementById('saleUnitPrice').value)||0;
            if(quantity>0&&unitPrice>0){
                const total=quantity*unitPrice;
                document.getElementById('saleTotalAmount').value=total.toFixed(2);
            }
            calculateSaleRemaining();
        }
        
        function toggleSalePaymentFields(){
            const status=document.getElementById('salePaymentStatus').value;
            const detailsRow=document.getElementById('salePaymentDetailsRow');
            if(status==='partial'||status==='pending'){
                detailsRow.style.display='grid';
            }else{
                detailsRow.style.display='none';
            }
            calculateSaleRemaining();
        }
        
        function calculateSaleRemaining(){
            const total=parseFloat(document.getElementById('saleTotalAmount').value)||0;
            const paid=parseFloat(document.getElementById('saleAmountPaid').value)||0;
            const remaining=total-paid;
            document.getElementById('saleAmountRemaining').value=remaining.toFixed(2);
        }
        
        async function saveAnimal(){
            try{
                const animalData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    tag_number:document.getElementById('animalTag').value,
                    species:document.getElementById('animalSpecies').value,
                    sex:document.getElementById('animalSex').value,
                    birth_date:document.getElementById('animalBirthDate').value||null,
                    weight_kg:document.getElementById('animalWeight').value||null,
                    breed:document.getElementById('animalBreed').value||null,
                    color:document.getElementById('animalColor').value||null,
                    health_status:document.getElementById('animalHealthStatus').value,
                    special_marks:document.getElementById('animalMarks').value||null,
                    notes:document.getElementById('animalNotes').value||null,
                    last_weight_date:document.getElementById('animalWeight').value?new Date().toISOString().split('T')[0]:null
                };
                const animalId=document.getElementById('animalId').value;
                let error;
                if(animalId){
                    const result=await supabase.from('animals').update(animalData).eq('id',animalId);
                    error=result.error;
                }else{
                    animalData.status='alive';
                    const result=await supabase.from('animals').insert([animalData]);
                    error=result.error;
                }
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ŸäŸàÿßŸÜ ÿ®ŸÜÿ¨ÿßÿ≠');
                closeModal('animalModal');
                loadAnimals();
                loadStats();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function deleteAnimal(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≠ŸäŸàÿßŸÜÿü'))return;
            try{
                const{error}=await supabase.from('animals').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ŸäŸàÿßŸÜ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadAnimals();
                loadStats();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function saveHealthRecord(){
            try{
                const recordData={
                    user_id:currentUser.id,
                    animal_id:document.getElementById('healthAnimal').value,
                    record_type:document.getElementById('healthRecordType').value,
                    date:document.getElementById('healthDate').value,
                    vaccine_name:document.getElementById('healthName').value||null,
                    disease_name:document.getElementById('healthName').value||null,
                    treatment:document.getElementById('healthTreatment').value||null,
                    veterinarian_name:document.getElementById('healthVet').value||null,
                    veterinarian_phone:document.getElementById('healthVetPhone').value||null,
                    cost:document.getElementById('healthCost').value||null,
                    next_date:document.getElementById('healthNextDate').value||null,
                    notes:document.getElementById('healthNotes').value||null
                };
                const editId=document.getElementById('healthForm').getAttribute('data-edit-id');
                let error;
                if(editId){
                    const result=await supabase.from('health_records').update(recordData).eq('id',editId);
                    error=result.error;
                    document.getElementById('healthForm').removeAttribute('data-edit-id');
                }else{
                    const result=await supabase.from('health_records').insert([recordData]);
                    error=result.error;
                }
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿµÿ≠Ÿä ÿ®ŸÜÿ¨ÿßÿ≠');
                closeModal('healthModal');
                loadHealthRecords();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function saveBirth(){
            try{
                const motherId=document.getElementById('birthMother').value;
                const fatherId=document.getElementById('birthFather').value||null;
                const birthDate=document.getElementById('birthActualDate').value;
                const aliveCount=parseInt(document.getElementById('birthAlive').value)||0;
                const avgWeight=document.getElementById('birthAvgWeight').value||null;
                
                const birthData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    mother_id:motherId,
                    father_id:fatherId,
                    mating_date:document.getElementById('birthMatingDate').value||null,
                    expected_birth_date:document.getElementById('birthExpectedDate').value||null,
                    actual_birth_date:birthDate,
                    total_born:parseInt(document.getElementById('birthTotal').value)||0,
                    alive_count:aliveCount,
                    dead_count:parseInt(document.getElementById('birthDead').value)||0,
                    average_birth_weight:avgWeight,
                    complications:document.getElementById('birthComplications').value||null,
                    notes:document.getElementById('birthNotes').value||null
                };
                
                const editId=document.getElementById('birthForm').getAttribute('data-edit-id');
                let error;
                
                if(editId){
                    const result=await supabase.from('births').update(birthData).eq('id',editId);
                    error=result.error;
                    document.getElementById('birthForm').removeAttribute('data-edit-id');
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàŸÑÿßÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                }else{
                    const result=await supabase.from('births').insert([birthData]);
                    error=result.error;
                    
                    if(!error){
                        const{data:mother}=await supabase.from('animals').select('species,tag_number').eq('id',motherId).single();
                        const lambsToInsert=[];
                        for(let i=1;i<=aliveCount;i++){
                            lambsToInsert.push({
                                user_id:currentUser.id,
                                project_id:currentProjectId,
                                tag_number:`${mother?.tag_number||'M'}-${birthDate}-${i}`,
                                species:mother?.species||'sheep',
                                sex:i%2===0?'female':'male',
                                birth_date:birthDate,
                                weight_kg:avgWeight,
                                mother_id:motherId,
                                father_id:fatherId,
                                status:'alive',
                                health_status:'healthy',
                                notes:`ŸÖŸàŸÑŸàÿØ ŸÖŸÜ ÿßŸÑŸàŸÑÿßÿØÿ© ÿ®ÿ™ÿßÿ±ŸäÿÆ ${birthDate}`
                            });
                        }
                        if(lambsToInsert.length>0){
                            const{error:lambsError}=await supabase.from('animals').insert(lambsToInsert);
                            if(lambsError)throw lambsError;
                        }
                    }
                    showSuccess(`ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸàŸÑÿßÿØÿ© Ÿàÿ•ÿ∂ÿßŸÅÿ© ${aliveCount} ÿ≠ŸÖŸÑÿßŸÜ ÿ®ŸÜÿ¨ÿßÿ≠`);
                }
                
                if(error)throw error;
                closeModal('birthModal');
                await loadBirths();
                await loadAnimals();
                await loadStats();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function saveFeeding(){
            try{
                const feedItems=[];
                const materialSelects=document.querySelectorAll('.feed-material-select');
                
                for(const select of materialSelects){
                    if(select.value){
                        const id=select.dataset.id;
                        const quantityInput=document.querySelector(`.feed-quantity[data-id="${id}"]`);
                        const quantity=parseFloat(quantityInput.value);
                        
                        if(!quantity||quantity<=0){
                            showError('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÉŸÖŸäÿ© ÿµÿ≠Ÿäÿ≠ÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿßÿØ');
                            return;
                        }
                        
                        const selectedOption=select.options[select.selectedIndex];
                        const available=parseFloat(selectedOption.dataset.available);
                        
                        const editId=document.getElementById('feedingForm').getAttribute('data-edit-id');
                        if(!editId&&quantity>available){
                            showError(`ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ™ŸàŸÅÿ±ÿ© ŸÖŸÜ ${selectedOption.text.split(' (')[0]} ÿ∫Ÿäÿ± ŸÉÿßŸÅŸäÿ©`);
                            return;
                        }
                        
                        feedItems.push({
                            inventory_id:select.value,
                            item_name:selectedOption.text.split(' (')[0],
                            quantity:quantity,
                            unit:selectedOption.dataset.unit,
                            unit_price:parseFloat(selectedOption.dataset.price)||0
                        });
                    }
                }
                
                if(feedItems.length===0){
                    showError('Ÿäÿ¨ÿ® ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿßÿØÿ© Ÿàÿßÿ≠ÿØÿ© ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
                    return;
                }
                
                const feedData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    feed_date:document.getElementById('feedDate').value,
                    animals_count:document.getElementById('feedAnimalsCount').value||null,
                    feed_items:feedItems,
                    total_cost:parseFloat(document.getElementById('feedTotalCost').value)||0,
                    fed_by:document.getElementById('feedFedBy').value||null,
                    notes:document.getElementById('feedNotes').value||null
                };
                
                const editId=document.getElementById('feedingForm').getAttribute('data-edit-id');
                let error;
                
                if(editId){
                    const result=await supabase.from('feed_log').update(feedData).eq('id',editId);
                    error=result.error;
                    document.getElementById('feedingForm').removeAttribute('data-edit-id');
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                }else{
                    const result=await supabase.from('feed_log').insert([feedData]);
                    error=result.error;
                    
                    if(!error){
                        for(const item of feedItems){
                            await supabase.from('inventory_movements').insert([{
                                user_id:currentUser.id,
                                inventory_id:item.inventory_id,
                                movement_type:'project_usage',
                                quantity:item.quantity,
                                unit:item.unit,
                                project_id:currentProjectId,
                                reason:'ÿ™ÿ∫ÿ∞Ÿäÿ© ÿßŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™',
                                unit_price:item.unit_price,
                                total_cost:item.quantity*item.unit_price,
                                performed_at:new Date().toISOString()
                            }]);
                        }
                    }
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                }
                
                if(error)throw error;
                closeModal('feedingModal');
                loadFeedings();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function saveSale(){
            try{
                const animalId=document.getElementById('saleAnimal').value||null;
                const quantity=parseFloat(document.getElementById('saleQuantity').value);
                const totalAmount=parseFloat(document.getElementById('saleTotalAmount').value);
                let unitPrice=parseFloat(document.getElementById('saleUnitPrice').value);
                
                if(!unitPrice||unitPrice<=0){
                    if(quantity>0&&totalAmount>0){
                        unitPrice=totalAmount/quantity;
                    }else{
                        showError('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ© ÿ£Ÿà ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä');
                        return;
                    }
                }
                
                const paymentStatus=document.getElementById('salePaymentStatus').value;
                const amountPaid=parseFloat(document.getElementById('saleAmountPaid').value)||0;
                const amountRemaining=parseFloat(document.getElementById('saleAmountRemaining').value)||0;
                
                const saleData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    sale_date:document.getElementById('saleDate').value,
                    item_type:document.getElementById('saleItemType').value,
                    item_description:document.getElementById('saleDescription').value||null,
                    animal_id:animalId,
                    quantity:quantity,
                    unit:document.getElementById('saleUnit').value,
                    unit_price:unitPrice,
                    total_amount:totalAmount,
                    buyer_name:document.getElementById('saleBuyerName').value||null,
                    buyer_phone:document.getElementById('saleBuyerPhone').value||null,
                    buyer_address:document.getElementById('saleBuyerAddress').value||null,
                    payment_method:document.getElementById('salePaymentMethod').value,
                    payment_status:paymentStatus,
                    amount_paid:amountPaid||null,
                    amount_remaining:amountRemaining||null,
                    notes:document.getElementById('saleNotes').value||null
                };
                
                const editId=document.getElementById('saleForm').getAttribute('data-edit-id');
                let error;
                
                if(editId){
                    const result=await supabase.from('sales').update(saleData).eq('id',editId);
                    error=result.error;
                    document.getElementById('saleForm').removeAttribute('data-edit-id');
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ®Ÿäÿπÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                }else{
                    const result=await supabase.from('sales').insert([saleData]);
                    error=result.error;
                    
                    if(!error){
                        if(animalId){
                            await supabase.from('animals').update({status:'sold'}).eq('id',animalId);
                        }
                        
                        if(amountRemaining>0&&(paymentStatus==='partial'||paymentStatus==='pending')){
                            const buyerName=document.getElementById('saleBuyerName').value;
                            const buyerPhone=document.getElementById('saleBuyerPhone').value;
                            const buyerAddress=document.getElementById('saleBuyerAddress').value;
                            
                            if(buyerName&&buyerPhone){
                                const loanData={
                                    user_id:currentUser.id,
                                    project_id:currentProjectId,
                                    loan_date:document.getElementById('saleDate').value,
                                    animal_id:animalId,
                                    borrower_name:buyerName,
                                    borrower_phone:buyerPhone,
                                    borrower_address:buyerAddress||null,
                                    loan_amount:amountRemaining,
                                    amount_paid:0,
                                    notes:`ŸÇÿ±ÿ∂ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖŸÜ ÿ®Ÿäÿπ - ${saleData.item_description||translateItemType(saleData.item_type)}`
                                };
                                
                                await supabase.from('sheep_loans').insert([loanData]);
                                showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ®Ÿäÿπ Ÿàÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿ±ÿ∂ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ŸÜÿ¨ÿßÿ≠');
                            }else{
                                showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ®Ÿäÿπ ÿ®ŸÜÿ¨ÿßÿ≠ (ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ±ÿ∂ ŸÑÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿä ŸÉÿßŸÖŸÑÿ©)');
                            }
                        }else{
                            showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ®Ÿäÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
                        }
                    }
                }
                
                if(error)throw error;
                closeModal('saleModal');
                loadSales();
                if(animalId){
                    loadAnimals();
                    loadStats();
                }
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function saveLoan(){
            try{
                const loanData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    loan_date:document.getElementById('loanDate').value,
                    animal_id:document.getElementById('loanAnimal').value||null,
                    borrower_name:document.getElementById('loanBorrowerName').value,
                    borrower_phone:document.getElementById('loanBorrowerPhone').value,
                    borrower_address:document.getElementById('loanBorrowerAddress').value||null,
                    loan_amount:parseFloat(document.getElementById('loanAmount').value),
                    amount_paid:parseFloat(document.getElementById('loanAmountPaid').value)||0,
                    notes:document.getElementById('loanNotes').value||null
                };
                const{error}=await supabase.from('sheep_loans').insert([loanData]);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿ±ÿ∂ ÿ®ŸÜÿ¨ÿßÿ≠');
                closeModal('loanModal');
                loadLoans();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function saveExpense(){
            try{
                const expenseDate=document.getElementById('expenseDate').value;
                const category=document.getElementById('expenseCategory').value;
                const description=document.getElementById('expenseDescription').value;
                const amount=parseFloat(document.getElementById('expenseAmount').value);
                
                if(!expenseDate||!category||!description||!amount||amount<=0){
                    showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                    return;
                }
                
                const expenseData={
                    user_id:currentUser.id,
                    project_id:currentProjectId,
                    expense_date:expenseDate,
                    category:category,
                    description:description,
                    amount:amount,
                    paid_to:document.getElementById('expensePaidTo').value||null,
                    payment_method:document.getElementById('expensePaymentMethod').value||'cash',
                    receipt_number:document.getElementById('expenseReceiptNumber').value||null,
                    notes:document.getElementById('expenseNotes').value||null
                };
                
                const editId=document.getElementById('expenseForm').getAttribute('data-edit-id');
                let error;
                
                if(editId){
                    const result=await supabase.from('expenses').update(expenseData).eq('id',editId);
                    error=result.error;
                    document.getElementById('expenseForm').removeAttribute('data-edit-id');
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿµÿ±ŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                }else{
                    const result=await supabase.from('expenses').insert([expenseData]);
                    error=result.error;
                    showSuccess('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                }
                
                if(error)throw error;
                closeModal('expenseModal');
                loadExpenses();
            }catch(error){
                console.error('Error saving expense:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: '+error.message);
            }
        }
        
        async function editProject(){
            const newName=prompt('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿßŸÑÿ¨ÿØŸäÿØ:',currentProject.name);
            if(newName&&newName.trim()){
                try{
                    const{error}=await supabase.from('projects').update({name:newName.trim()}).eq('id',currentProjectId);
                    if(error)throw error;
                    showSuccess('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadProject();
                }catch(error){
                    console.error('Error:',error);
                    showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´');
                }
            }
        }
        
        async function toggleProjectStatus(){
            try{
                const newStatus=currentProject.status==='active'?'inactive':'active';
                const{error}=await supabase.from('projects').update({status:newStatus}).eq('id',currentProjectId);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadProject();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ©');
            }
        }
        
        async function deleteProject(){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπÿü ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®Ÿá!'))return;
            try{
                const{error}=await supabase.from('projects').delete().eq('id',currentProjectId);
                if(error)throw error;
                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
                window.location.href='../../index.html';
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function recordLoanPayment(loanId,remaining){
            const amount=prompt(`ÿ£ÿØÿÆŸÑ ŸÖÿ®ŸÑÿ∫ ÿßŸÑÿØŸÅÿπÿ© (ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${remaining.toFixed(2)} ÿØÿ¨):`);
            if(!amount||isNaN(amount)||parseFloat(amount)<=0)return;
            try{
                const{data:loan,error:fetchError}=await supabase.from('sheep_loans').select('*').eq('id',loanId).single();
                if(fetchError)throw fetchError;
                const newAmountPaid=(loan.amount_paid||0)+parseFloat(amount);
                const{error}=await supabase.from('sheep_loans').update({amount_paid:newAmountPaid,updated_at:new Date().toISOString()}).eq('id',loanId);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØŸÅÿπÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                loadLoans();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØŸÅÿπÿ©');
            }
        }
        
        async function deleteHealthRecord(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿµÿ≠Ÿäÿü'))return;
            try{
                const{error}=await supabase.from('health_records').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadHealthRecords();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function deleteBirth(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑŸàŸÑÿßÿØÿ©ÿü (ŸÑŸÜ Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿßŸÑŸäÿØ)'))return;
            try{
                const{error}=await supabase.from('births').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadBirths();
                loadStats();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function deleteFeeding(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©ÿü'))return;
            try{
                const{error}=await supabase.from('feed_log').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadFeedings();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function deleteSale(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ®Ÿäÿπÿü'))return;
            try{
                const{error}=await supabase.from('sales').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadSales();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function deleteLoan(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑŸÇÿ±ÿ∂ÿü'))return;
            try{
                const{error}=await supabase.from('sheep_loans').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadLoans();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        async function deleteExpense(id){
            if(!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿü'))return;
            try{
                const{error}=await supabase.from('expenses').delete().eq('id',id);
                if(error)throw error;
                showSuccess('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿ±ŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                loadExpenses();
            }catch(error){
                console.error('Error:',error);
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ');
            }
        }
        
        function setDefaultDate(){
            const today=new Date().toISOString().split('T')[0];
            setTimeout(()=>{
                const dateInputs=['feedDate','saleDate','loanDate','expenseDate','healthDate','birthActualDate'];
                dateInputs.forEach(id=>{
                    const input=document.getElementById(id);
                    if(input&&!input.value)input.value=today;
                });
            },100);
        }
        
        function formatDate(dateString){
            if(!dateString)return'-';
            const date=new Date(dateString);
            return date.toLocaleDateString('ar-DZ');
        }
        
        function calculateAge(birthDate){
            if(!birthDate)return'-';
            const birth=new Date(birthDate);
            const today=new Date();
            const diffTime=Math.abs(today-birth);
            const diffDays=Math.ceil(diffTime/(1000*60*60*24));
            if(diffDays<30)return diffDays+' ŸäŸàŸÖ';
            else if(diffDays<365){
                const months=Math.floor(diffDays/30);
                return months+' ÿ¥Ÿáÿ±';
            }else{
                const years=Math.floor(diffDays/365);
                const remainingMonths=Math.floor((diffDays%365)/30);
                return years+' ÿ≥ŸÜÿ©'+(remainingMonths>0?' Ÿà '+remainingMonths+' ÿ¥Ÿáÿ±':'');
            }
        }
        
        function formatFeedItems(items){
            if(!items||items.length===0)return'-';
            try{
                const feedItems=typeof items==='string'?JSON.parse(items):items;
                return feedItems.map(item=>item.item_name).join(', ');
            }catch{
                return'-';
            }
        }
        
        function translateSpecies(species){const t={'sheep':'ÿ∫ŸÜŸÖ','goat':'ŸÖÿßÿπÿ≤'};return t[species]||species;}
        function translateSex(sex){const t={'male':'ÿ∞ŸÉÿ±','female':'ÿ£ŸÜÿ´Ÿâ'};return t[sex]||sex;}
        function translateStatus(status){const t={'alive':'ÿ≠Ÿä','sold':'ŸÖÿ®ÿßÿπ','died':'ŸÜÿßŸÅŸÇ','slaughtered':'ŸÖÿ∞ÿ®Ÿàÿ≠'};return t[status]||status;}
        function translateHealthStatus(status){const t={'healthy':'ÿ≥ŸÑŸäŸÖ','sick':'ŸÖÿ±Ÿäÿ∂','quarantine':'ÿ≠ÿ¨ÿ± ÿµÿ≠Ÿä','treatment':'ÿ™ÿ≠ÿ™ ÿßŸÑÿπŸÑÿßÿ¨'};return t[status]||status;}
        function translateRecordType(type){const t={'vaccination':'ÿ™ÿ∑ÿπŸäŸÖ','treatment':'ÿπŸÑÿßÿ¨','checkup':'ŸÅÿ≠ÿµ','disease':'ŸÖÿ±ÿ∂'};return t[type]||type;}
        function translateItemType(type){const t={'live_animal':'ÿ≠ŸäŸàÿßŸÜ ÿ≠Ÿä','meat':'ŸÑÿ≠ŸàŸÖ','wool':'ÿµŸàŸÅ','milk':'ÿ≠ŸÑŸäÿ®','other':'ÿ£ÿÆÿ±Ÿâ'};return t[type]||type;}
        function translateUnit(unit){const t={'head':'ÿ±ÿ£ÿ≥','kg':'ŸÉÿ¨ŸÖ','liter':'ŸÑÿ™ÿ±','piece':'ŸÇÿ∑ÿπÿ©'};return t[unit]||unit;}
        function translatePaymentStatus(status){const t={'paid':'ŸÖÿØŸÅŸàÿπ','partial':'ÿØŸÅÿπ ÿ¨ÿ≤ÿ¶Ÿä','pending':'ŸÖÿπŸÑŸÇ'};return t[status]||status;}
        function translatePaymentMethod(method){const t={'cash':'ŸÜŸÇÿØŸä','bank_transfer':'ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä','check':'ÿ¥ŸäŸÉ','installment':'ÿ™ŸÇÿ≥Ÿäÿ∑'};return t[method]||method;}
        function translateExpenseCategory(category){const t={'feeding':'ÿ™ÿ∫ÿ∞Ÿäÿ©','health':'ÿµÿ≠ÿ©','labor':'ÿ£ÿ¨Ÿàÿ± ÿπŸÖÿßŸÑ','cleaning':'ÿ™ŸÜÿ∏ŸäŸÅ','sterilization':'ÿ™ÿπŸÇŸäŸÖ','maintenance':'ÿµŸäÿßŸÜÿ©','other':'ÿ£ÿÆÿ±Ÿâ'};return t[category]||category;}
        function getStatusColor(status){const c={'alive':'success','sold':'info','died':'danger','slaughtered':'secondary'};return c[status]||'secondary';}
        function getHealthColor(status){const c={'healthy':'success','sick':'danger','quarantine':'warning','treatment':'info'};return c[status]||'secondary';}
        function getPaymentStatusColor(status){const c={'paid':'success','partial':'warning','pending':'danger'};return c[status]||'secondary';}
        
        function showSuccess(message){
            const alert=document.getElementById('successAlert');
            alert.textContent=message;
            alert.classList.add('show');
            setTimeout(()=>{alert.classList.remove('show');},5000);
        }
        
        function showError(message){
            const alert=document.getElementById('errorAlert');
            alert.textContent=message;
            alert.classList.add('show');
            setTimeout(()=>{alert.classList.remove('show');},5000);
        }
    </script>
</body>
</html>
